# –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å–∏—Å—Ç–µ–º—ã –∑–∞–ø–∏—Å–∏

–ï–¥–∏–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤. –ö–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞ ‚Äî –≤ –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö.

---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî —Ç—Ä–∏ –±–ª–æ–∫–∞

```mermaid
flowchart TB
  subgraph TIME ["‚è± –ë–ª–æ–∫ –í–†–ï–ú–Ø"]
    direction TB
    T1["–õ–æ–∫–∞—Ü–∏–∏ (—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ)"]
    T2["–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã (–≥—Ä–∞—Ñ–∏–∫)"]
    T3["–ö–∞–±–∏–Ω–µ—Ç—ã"]
    T4["Calendar overrides"]
    T1 ~~~ T2 ~~~ T3 ~~~ T4
  end

  subgraph SVC ["üìã –ë–ª–æ–∫ –£–°–õ–£–ì–ò"]
    direction TB
    S1["–£—Å–ª—É–≥–∏ (—Ü–µ–Ω–∞, –≤—Ä–µ–º—è)"]
    S2["–ü–∞–∫–µ—Ç—ã / –ü—Ä–µ—Å–µ—Ç—ã"]
    S3["–°–∫–∏–¥–∫–∏"]
    S1 ~~~ S2 ~~~ S3
  end

  subgraph MONEY ["üí∞ –ë–ª–æ–∫ –î–ï–ù–¨–ì–ò (–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π)"]
    direction TB
    M1["–ö–æ—à–µ–ª—ë–∫"]
    M2["–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–π –∞—É–¥–∏—Ç)"]
    M1 ~~~ M2
  end

  TIME <-- "–°–µ–∞–Ω—Å (Booking)\nduration + service_ids" --> SVC
  SVC -- "done ¬∑ refund ¬∑ purchase" --> MONEY
```

**–ì—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏:**

- **–í–†–ï–ú–Ø ‚Üî –£–°–õ–£–ì–ò:** –ë–ª–æ–∫ –í–†–ï–ú–Ø –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç –ë–ª–æ–∫–∞ –£–°–õ–£–ì–ò —Ç–æ–ª—å–∫–æ **—Å—É–º–º–∞—Ä–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** + **—Å–ø–∏—Å–æ–∫ service_id** (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤). –¶–µ–Ω—ã, –ø–∞–∫–µ—Ç—ã, —Å–∫–∏–¥–∫–∏ ‚Äî –Ω–µ –∑–Ω–∞–µ—Ç.
- **–£–°–õ–£–ì–ò ‚Üí –î–ï–ù–¨–ì–ò:** –ë–ª–æ–∫ –î–ï–ù–¨–ì–ò ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å. –ï–º—É –Ω–µ –≤–∞–∂–Ω–æ –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª —Ç—Ä–∏–≥–≥–µ—Ä (`done`, –ø—Ä–æ–¥–∞–∂–∞ –ø–∞–∫–µ—Ç–∞, –≤–æ–∑–≤—Ä–∞—Ç, —Ä—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞). –û–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –≤–µ–¥—ë—Ç –∞—É–¥–∏—Ç. –ù–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ —Å–ª–æ—Ç—ã, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –∫–∞–±–∏–Ω–µ—Ç—ã.
- **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í–†–ï–ú–Ø –∏ –£–°–õ–£–ì–ò —Ä–∞–±–æ—Ç–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–∑–∞–ø–∏—Å—å). –î–ï–ù–¨–ì–ò —Ä–∞–±–æ—Ç–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ ‚Äî –ø–æ—Å—Ç—Ñ–∞–∫—Ç—É–º, –ø–æ —Å–æ–±—ã—Ç–∏—è–º.

---

## 2. –°—É—â–Ω–æ—Å—Ç–∏

### –ë–ª–æ–∫ –í–†–ï–ú–Ø

| –°—É—â–Ω–æ—Å—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è |
|----------|------------|---------------|
| **–õ–æ–∫–∞—Ü–∏—è** | –§–∏–∑–∏—á–µ—Å–∫–∞—è —Ç–æ—á–∫–∞. –ë–∞–∑–æ–≤–∞—è —Å–µ—Ç–∫–∞ —Å–ª–æ—Ç–æ–≤ (—Ñ–∞–∑–∞ 1) | `work_schedule` (JSON), –∫–∞–±–∏–Ω–µ—Ç—ã |
| **–ö–∞–±–∏–Ω–µ—Ç** | –†–µ—Å—É—Ä—Å –≤–Ω—É—Ç—Ä–∏ –ª–æ–∫–∞—Ü–∏–∏. –ü—Ä–∏–≤—è–∑–∞–Ω –∫ —É—Å–ª—É–≥–∞–º (`service_rooms`) | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ—Å—Ç—å –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ |
| **–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç** | –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å. –°–≤–æ–π –≥—Ä–∞—Ñ–∏–∫ (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –ª–æ–∫–∞—Ü–∏–µ–π) | `work_schedule` (JSON), `specialist_services` |
| **Calendar overrides** | –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –ª—é–±–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ | `target_type` (location/room/specialist), `override_kind` (day_off, block, ...) |

### –ë–ª–æ–∫ –£–°–õ–£–ì–ò

| –°—É—â–Ω–æ—Å—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è |
|----------|------------|---------------|
| **–£—Å–ª—É–≥–∞** | –ê—Ç–æ–º–∞—Ä–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ | `duration_min`, `break_min`, `price`, `price_5`, `price_10` |
| **–ü–∞–∫–µ—Ç / –ü—Ä–µ—Å–µ—Ç** | –ï–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `service_packages` (—Å–º. –Ω–∏–∂–µ) | `package_items` (JSON), `package_price`, `qty`, `show_on_pricing`, `show_on_booking` |
| **–°–∫–∏–¥–∫–∞** | –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∏–ª–∏ –∞–∫—Ü–∏–æ–Ω–Ω–∞—è | `client_discounts`: `user_id`, `discount_percent`, `valid_from/valid_to` |

**–ü–∞–∫–µ—Ç vs –ü—Ä–µ—Å–µ—Ç** (–æ–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `service_packages`):

| | –ü—Ä–µ—Å–µ—Ç (qty=1) | –ü–∞–∫–µ—Ç (qty=5/10) |
|---|---|---|
| **–ß—Ç–æ —ç—Ç–æ** | –ï–¥–∏–Ω–∏—Ü–∞ –≤—ã–±–æ—Ä–∞ –Ω–∞ UI –∑–∞–ø–∏—Å–∏ | –¢–æ–≤–∞—Ä –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ (—Ñ–∏–Ω–∞–Ω—Å—ã, –∫–æ—à–µ–ª—ë–∫) |
| **–í–∏–¥–∏–º–æ—Å—Ç—å** | `show_on_booking` | `show_on_pricing` |
| **–¶–µ–Ω–∞** | –°—É–º–º–∞ —Ü–µ–Ω —É—Å–ª—É–≥ (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è) | –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑ `price_5`/`price_10` —É—Å–ª—É–≥ (–æ–ø—Ç–æ–≤–∞—è —Å–∫–∏–¥–∫–∞) |
| **–ü—Ä–∏–º–µ—Ä** | ¬´–ê–Ω—Ç–∏—Ü–µ–ª–ª—é–ª–∏—Ç–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å¬ª (LPG + –ø—Ä–µ—Å—Å–æ—Ç–µ—Ä–∞–ø–∏—è) | ¬´LPG 10 —Å–µ–∞–Ω—Å–æ–≤¬ª |

### –ë–ª–æ–∫ –î–ï–ù–¨–ì–ò (–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π)

–û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –æ—Å–Ω–æ–≤–Ω–æ–º—É. –ù–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Å–ª–æ—Ç—ã, –∫–∞–±–∏–Ω–µ—Ç—ã. –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏—è:

| –°–æ–±—ã—Ç–∏–µ | –û–ø–µ—Ä–∞—Ü–∏—è |
|---------|----------|
| –ü—Ä–æ–¥–∞–∂–∞ –ø–∞–∫–µ—Ç–∞ | `deposit` –Ω–∞ —Å—É–º–º—É –ø–∞–∫–µ—Ç–∞ |
| Booking ‚Üí `done` (–ø–∞–∫–µ—Ç –µ—Å—Ç—å) | `withdraw` –Ω–∞ unit_price |
| Booking ‚Üí `done` (–±–µ–∑ –ø–∞–∫–µ—Ç–∞) | `deposit` + `withdraw` (–∞—É–¥–∏—Ç —Ä–∞–∑–æ–≤–æ–π —É—Å–ª—É–≥–∏) |
| –í–æ–∑–≤—Ä–∞—Ç –æ—Å—Ç–∞—Ç–∫–∞ –ø–∞–∫–µ—Ç–∞ | `withdraw` –Ω–∞ remaining √ó unit_price |
| –†—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ | `correction` (¬±) |

| –°—É—â–Ω–æ—Å—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------|
| **–ö–æ—à–µ–ª—ë–∫** (`client_wallets`) | –ë–∞–ª–∞–Ω—Å –∫–ª–∏–µ–Ω—Ç–∞. –û–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ |
| **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** (`wallet_transactions`) | –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π |

–ë–ª–æ–∫—É –î–ï–ù–¨–ì–ò –Ω–µ –≤–∞–∂–µ–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∏–≥–≥–µ—Ä–∞ ‚Äî –±–æ—Ç, web, –∞–¥–º–∏–Ω–∫–∞. –û–Ω –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É (deposit/withdraw/refund/correction) –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç.

–î–µ—Ç–∞–ª–∏: [`docs/wallet.md`](wallet.md)

### –ú–æ—Å—Ç: –°–µ–∞–Ω—Å (Booking)

Booking ‚Äî –µ–¥–∏–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ, —Å–≤—è–∑—ã–≤–∞–µ—Ç –æ–±–∞ –±–ª–æ–∫–∞:

- –ú–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –æ–¥–Ω—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å–ª—É–≥ (—á–µ—Ä–µ–∑ –ø—Ä–µ—Å–µ—Ç)
- –û–±—â–µ–µ –≤—Ä–µ–º—è = `sum(duration + break)` –ø–æ –≤—Å–µ–º —É—Å–ª—É–≥–∞–º ‚Üí UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–µ –≤—Ä–µ–º—è
- –ü—Ä–∏–≤—è–∑–∞–Ω –∫: –ø—Ä–µ—Å–µ—Ç/—É—Å–ª—É–≥–∞ + —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç + –ª–æ–∫–∞—Ü–∏—è + –∫–∞–±–∏–Ω–µ—Ç + –∫–ª–∏–µ–Ω—Ç + –≤—Ä–µ–º—è
- –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª: `pending` ‚Üí `confirmed` ‚Üí `done` / `cancelled` / `no_show`
- `done` ‚Üí —Ç—Ä–∏–≥–≥–µ—Ä –ë–ª–æ–∫–∞ –î–ï–ù–¨–ì–ò

**–ö–æ–º–ø–ª–µ–∫—Å ‚â† –ø–∞–∫–µ—Ç:** –∫–æ–º–ø–ª–µ–∫—Å (–ø—Ä–µ—Å–µ—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å–ª—É–≥) ‚Äî —Ä–∞–∑–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ –ø–æ –ø–æ–ª–Ω—ã–º —Ü–µ–Ω–∞–º. –ü–∞–∫–µ—Ç ‚Äî –ø—Ä–µ–¥–æ–ø–ª–∞—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä N —Å–µ–∞–Ω—Å–æ–≤ –ø–æ –æ–ø—Ç–æ–≤–æ–π —Ü–µ–Ω–µ.

---

## 3. –†–∞—Å—á—ë—Ç —Å–ª–æ—Ç–æ–≤ (–ë–ª–æ–∫ –í–†–ï–ú–Ø)

### –§–∞–∑–∞ 1 ‚Äî –±–∞–∑–æ–≤–∞—è —Å–µ—Ç–∫–∞ (Redis, –∫–µ—à)

- **–í—Ö–æ–¥:** `locations.work_schedule` + `calendar_overrides` (target=location)
- **–®–∞–≥:** 15 –º–∏–Ω—É—Ç
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ZSET –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–µ–º—ë–Ω (`time_str` ‚Üí `expire_ts`)
- **–ù–ï —É—á–∏—Ç—ã–≤–∞–µ—Ç:** —É—Å–ª—É–≥–∏, —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–∞–±–∏–Ω–µ—Ç—ã

### –§–∞–∑–∞ 2 ‚Äî –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ –ø—Ä–µ—Å–µ—Ç—É/—É—Å–ª—É–≥–µ (runtime)

- **–í—Ö–æ–¥:** —Ñ–∞–∑–∞ 1 + –ø—Ä–µ—Å–µ—Ç (—Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥) + –¥–∞—Ç–∞

```
total_time = sum(duration + break) –ø–æ –≤—Å–µ–º —É—Å–ª—É–≥–∞–º –ø—Ä–µ—Å–µ—Ç–∞
slots_needed = ceil(total_time / 15)

–°–ª–æ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω =
    –≤—Ä–µ–º—è ‚àà —Å–µ—Ç–∫–∞_–ª–æ–∫–∞—Ü–∏–∏ (—Ñ–∞–∑–∞ 1)
  ‚à© –≤—Ä–µ–º—è ‚àà –≥—Ä–∞—Ñ–∏–∫_—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
  ‚à© —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï —É—Å–ª—É–≥–∏ –ø—Ä–µ—Å–µ—Ç–∞
  ‚à© consecutive slots —Å–≤–æ–±–æ–¥–Ω—ã (slots_needed –ø–æ–¥—Ä—è–¥)
  ‚à© –Ω–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
  ‚à© –∫–∞–±–∏–Ω–µ—Ç —Å–≤–æ–±–æ–¥–µ–Ω –Ω–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥
```

**UI:** –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ + –æ–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´10:00 ‚Äî 2 —á¬ª)

–î–µ—Ç–∞–ª–∏: [`docs/booking.md`](booking.md)

---

## 4. –ü—Ä–∞–π—Å –∏ Flow –∑–∞–ø–∏—Å–∏

**–ü—Ä–∞–π—Å** ‚Äî –≤–∏—Ç—Ä–∏–Ω–∞ (–¥–æ—Å–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π). –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ª—É–≥–∏ –∏ –ø–∞–∫–µ—Ç—ã —Å —Ñ–ª–∞–≥–æ–º `show_on_pricing`. –ò–∑ –ø—Ä–∞–π—Å–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –∑–∞–ø–∏—Å—å.

### Flow 1 ‚Äî –∏–∑ –ø—Ä–∞–π—Å–∞

```
–í—ã–±—Ä–∞–ª –ø—Ä–µ—Å–µ—Ç –Ω–∞ –ø—Ä–∞–π—Å–µ ‚Üí –ø—Ä–µ—Å–µ—Ç —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω ‚Üí –¥–∞—Ç–∞ ‚Üí –≤—Ä–µ–º—è ‚Üí —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç
```

### Flow 2 ‚Äî –∏–∑ –∑–∞–ø–∏—Å–∏

```
–°–ø–∏—Å–æ–∫ –ø—Ä–µ—Å–µ—Ç–æ–≤ (qty=1, show_on_booking) ‚Üí –≤—ã–±—Ä–∞–ª ‚Üí –¥–∞—Ç–∞ ‚Üí –≤—Ä–µ–º—è ‚Üí —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç
```

---

## 5. –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ —Å–∫–∏–¥–∫–∏

### –£—Ä–æ–≤–Ω–∏ —Ü–µ–Ω

| –¢–∏–ø | –ò—Å—Ç–æ—á–Ω–∏–∫ —Ü–µ–Ω—ã | –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è |
|-----|---------------|-------------------|
| **–†–∞–∑–æ–≤–∞—è** | `services.price` | –û–¥–∏–Ω–æ—á–Ω–∞—è –∑–∞–ø–∏—Å—å –±–µ–∑ –ø–∞–∫–µ—Ç–∞ |
| **–ü–∞–∫–µ—Ç–Ω–∞—è (5 —Å–µ–∞–Ω—Å–æ–≤)** | `services.price_5` | –†–∞—Å—á—ë—Ç `package_price` –¥–ª—è qty=5 |
| **–ü–∞–∫–µ—Ç–Ω–∞—è (10 —Å–µ–∞–Ω—Å–æ–≤)** | `services.price_10` | –†–∞—Å—á—ë—Ç `package_price` –¥–ª—è qty=10 |

–¶–µ–Ω–∞ –ø–∞–∫–µ—Ç–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ `price_5`/`price_10` —É—Å–ª—É–≥, –≤—Ö–æ–¥—è—â–∏—Ö –≤ –ø–∞–∫–µ—Ç.

### –°–∫–∏–¥–∫–∏

| –¢–∏–ø | –ú–µ—Ö–∞–Ω–∏–∑–º | –•—Ä–∞–Ω–µ–Ω–∏–µ |
|-----|----------|----------|
| **–ü–∞–∫–µ—Ç–Ω–∞—è** | –û–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ —á–µ—Ä–µ–∑ `price_5`/`price_10` | `services` |
| **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è** | –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ | `client_discounts` (`user_id` –∑–∞–¥–∞–Ω) |
| **–ê–∫—Ü–∏–æ–Ω–Ω–∞—è** | –°–∫–∏–¥–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ | `client_discounts` (`user_id = NULL`) |

**–ü—Ä–∞–≤–∏–ª–æ: —Å–∫–∏–¥–∫–∏ –ù–ï —Å–æ–≤–º–µ—â–∞—é—Ç—Å—è.** –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –æ–¥–Ω–∞ ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö:
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞–∫–µ—Ç ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–∞–∫–µ—Ç–Ω–∞—è —Ü–µ–Ω–∞ (price_5/price_10)
- –ï—Å–ª–∏ –±–µ–∑ –ø–∞–∫–µ—Ç–∞ ‚Üí –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∏ –∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∏, –±–µ—Ä—ë—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è

–î–µ—Ç–∞–ª–∏: [`docs/wallet.md`](wallet.md)

---

## 6. –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

```mermaid
flowchart TB
  subgraph TIME ["‚è± –ë–ª–æ–∫ –í–†–ï–ú–Ø"]
    locations -- "1:N" --> rooms
    rooms -- "N:M" --> service_rooms
    specialists -- "N:M" --> specialist_services
    calendar_overrides
  end

  subgraph SVC ["üìã –ë–ª–æ–∫ –£–°–õ–£–ì–ò"]
    services -- "N:M" --> specialist_services
    services -- "1:N" --> service_packages
    service_packages -- "1:N" --> client_packages
    client_discounts
  end

  service_rooms --- services
  bookings

  locations -.-> bookings
  specialists -.-> bookings
  services -.-> bookings
  client_packages -.-> bookings

  subgraph MONEY ["üí∞ –ë–ª–æ–∫ –î–ï–ù–¨–ì–ò"]
    client_wallets -- "1:N" --> wallet_transactions
  end

  bookings -- "done ¬∑ cancel" --> wallet_transactions
```
