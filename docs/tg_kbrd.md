# UIâ€‘ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñ‹ Telegramâ€‘Ð±Ð¾Ñ‚Ð° (Reply / Inline)

> **Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº Ð¸ÑÑ‚Ð¸Ð½Ñ‹** Ð´Ð»Ñ Ð²ÑÐµÐ¹ Ð»Ð¾Ð³Ð¸ÐºÐ¸ Ð¼ÐµÐ½ÑŽ Ð¸ Ð½Ð°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ð¸.
> Ð›ÑŽÐ±Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² ÐºÐ¾Ð´Ðµ **Ð¾Ð±ÑÐ·Ð°Ð½Ñ‹** ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ð¼Ñƒ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñƒ.
> 
> **Ð’ÐµÑ€ÑÐ¸Ñ:** 3.0 (Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ, ÑÐºÐ¾Ñ€ÑŒ, inline cleanup, ÐµÐ´Ð¸Ð½Ð°Ñ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ)

---

## 1. Ð¦ÐµÐ»Ð¸ ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚Ð°

* ReplyKeyboard **Ð½Ðµ ÑÑ…Ð»Ð¾Ð¿Ñ‹Ð²Ð°ÐµÑ‚ÑÑ** Ð½Ð° Android
* Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ð°Ñ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° (IME) **Ð½Ðµ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ** Ð±ÐµÐ· Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸
* Ð§Ð°Ñ‚ Ð¾ÑÑ‚Ð°Ñ‘Ñ‚ÑÑ **Ñ‡Ð¸ÑÑ‚Ñ‹Ð¼** (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ 1 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð°)
* ÐŸÐ¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ **Ð´ÐµÑ‚ÐµÑ€Ð¼Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ** Ð¸ Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ð¼Ð¾Ðµ

---

## 2. Ð¢ÐµÑ€Ð¼Ð¸Ð½Ñ‹

| Ð¢ÐµÑ€Ð¼Ð¸Ð½                   | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ                                                      |
| ------------------------ | ------------------------------------------------------------- |
| **ReplyKeyboard**        | ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° Telegram (Ð²Ð½Ð¸Ð·Ñƒ ÑÐºÑ€Ð°Ð½Ð°)                            |
| **InlineKeyboard**       | ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð¿Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÐµÐ¼ (callback)                              |
| **Ð¯ÐºÐ¾Ñ€ÑŒ Ð¼ÐµÐ½ÑŽ**           | Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð° Ñ ReplyKeyboard                                |
| **last_menu_message_id** | `message_id` ÑÐºÐ¾Ñ€Ñ Ð² Redis                                    |
| **IME**                  | Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ð°Ñ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° Android                                  |

---

## 3. ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ

### 3.1 ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ReplyKeyboard

```python
ReplyKeyboardMarkup(
    keyboard=[...],
    resize_keyboard=True,
    is_persistent=True,  # ÐšÐ Ð˜Ð¢Ð˜Ð§ÐÐž Ð´Ð»Ñ Android!
)
```

**`is_persistent=True`** â€” Ð´ÐµÑ€Ð¶Ð¸Ñ‚ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ Ð²Ð¸Ð´Ð¸Ð¼Ð¾Ð¹, Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ IME.

### 3.2 Ð¢ÐµÐºÑÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ

**ZWS (`\u200b`) ÐÐ• Ð ÐÐ‘ÐžÐ¢ÐÐ•Ð¢** â€” Telegram API Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÑÐµÑ‚ ÐºÐ°Ðº Ð¿ÑƒÑÑ‚Ð¾Ð¹ Ñ‚ÐµÐºÑÑ‚.

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ:
- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¼ÐµÐ½ÑŽ: `"ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ"`, `"âš™ï¸ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"`
- ÐœÐ¸Ð½Ð¸Ð¼ÑƒÐ¼: emoji `"ðŸ“‹"`

### 3.3 Ð¥Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ

Redis Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ 3 ÐºÐ»ÑŽÑ‡Ð° Ð½Ð° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ `chat_id`:

| ÐšÐ»ÑŽÑ‡ | Ð¢Ð¸Ð¿ | Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ | TTL | ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ |
|------|-----|----------|-----|------------|
| `tg:menu:{chat_id}` | string | `message_id` ÑÐºÐ¾Ñ€Ñ | Ð½ÐµÑ‚ | Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Reply-ÑÐºÐ¾Ñ€ÑŒ (Ñ€Ð¾Ð²Ð½Ð¾ 0 Ð¸Ð»Ð¸ 1) |
| `tg:inline:{chat_id}` | list | `[msg_id, msg_id, â€¦]` | Ð½ÐµÑ‚ | Ð’ÑÐµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Inline-ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ, Ð¾Ð¶Ð¸Ð´Ð°ÑŽÑ‰Ð¸Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ |
| `tg:current_menu:{chat_id}` | string | Ð¸Ð¼Ñ Ð¼ÐµÐ½ÑŽ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ `"services"`) | Ð½ÐµÑ‚ | ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Reply-Ð¼ÐµÐ½ÑŽ Ð´Ð»Ñ Ñ€Ð¾ÑƒÑ‚Ð¸Ð½Ð³Ð° |

ÐœÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ð² `MenuController`:

```python
# Ð¯ÐºÐ¾Ñ€ÑŒ
_get_menu_id(chat_id)          # â†’ int | None
_set_menu_id(chat_id, msg_id)  # SET
_del_menu_id(chat_id)          # DEL

# Inline-ÑÐ¿Ð¸ÑÐ¾Ðº
_add_inline_id(chat_id, msg_id)  # RPUSH
_get_inline_ids(chat_id)         # LRANGE 0 -1 â†’ list[int]
_clear_inline_ids(chat_id)       # DEL

# ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð¼ÐµÐ½ÑŽ
set_menu_context(chat_id, name)  # SET
get_menu_context(chat_id)        # GET â†’ str | None
clear_menu_context(chat_id)      # DEL
```

### 3.4 ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹

**ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº (Ð¸Ð½Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚):** Ð¡ÐÐÐ§ÐÐ›Ð Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ, ÐŸÐžÐ¢ÐžÐœ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ñ‹Ðµ.
ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ Ð¿Ð¾Ñ€ÑÐ´ÐºÐ° Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¸Ñ‚ IME Ð½Ð° Android.

| ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ | User msg | Old anchor | Old inline | ÐœÐµÑ‚Ð¾Ð´ |
|---------|----------|------------|------------|-------|
| **A** (Replyâ†’Reply) | âœ… ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ | âœ… ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ | â€” | `show()` |
| **B1** (Replyâ†’Inline readonly) | âœ… ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ | âŒ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ | âœ… ÑƒÐ´Ð°Ð»ÑÑŽÑ‚ÑÑ (ÐµÑÐ»Ð¸ Ð±Ñ‹Ð»Ð¸) | `show_inline_readonly()` |
| **B2** (Replyâ†’Inline input) | âœ… ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ | âœ… ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ | âœ… ÑƒÐ´Ð°Ð»ÑÑŽÑ‚ÑÑ (ÐµÑÐ»Ð¸ Ð±Ñ‹Ð»Ð¸) | `show_inline_input()` |
| **C** (Replyâ†’Reply wizard) | âŒ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ | âœ… ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ | â€” | `show()` (Ð±ÐµÐ· delete user msg) |
| Inlineâ†’Inline | â€” | Ð½Ðµ Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ | â€” (edit in place) | `edit_inline()` |
| Inlineâ†’Reply | â€” | âœ… ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ (ÐµÑÐ»Ð¸ Ð±Ñ‹Ð») | âœ… Ð²ÑÐµ ÑƒÐ´Ð°Ð»ÑÑŽÑ‚ÑÑ | `back_to_reply()` |
| Reset (/start) | â€” | DEL Ð¸Ð· Redis | DEL Ð¸Ð· Redis | `reset()` |

**FSM error â€” Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ñ‚Ñ€ÐµÐºÐ¸Ð½Ð³:**
ÐšÐ¾Ð³Ð´Ð° Ð² FSM-ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Inline Ð²Ð½Ðµ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ñ‚Ð¾ÐºÐ° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¸ callback),
ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· `callback.message.edit_text()` Ð¸Ð»Ð¸ `mc.edit_inline()`.
Ð•ÑÐ»Ð¸ ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ÑÑ **Ð½Ð¾Ð²Ð¾Ðµ** ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ (Ð½Ðµ edit), ÐµÐ³Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ Ð·Ð°Ñ‚Ñ€ÐµÐºÐ°Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ:

```python
msg = await bot.send_message(chat_id, error_text, reply_markup=kb)
await mc._add_inline_id(chat_id, msg.message_id)
```

### 3.5 Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐºÐ¾Ñ€ÐµÐ¼ (Reply-anchor)

**Ð˜Ð½Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚:** Ð² ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð´Ð»Ñ `chat_id` ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ñ€Ð¾Ð²Ð½Ð¾ **0 Ð¸Ð»Ð¸ 1** ÑÐºÐ¾Ñ€ÑŒ.
ÐÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐºÐ¾Ñ€ÐµÐ¹ â€” Ð½ÐµÐ¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ð¾Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ (ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð½Ðµ ÑƒÐ´Ð°Ð»ÑÑ‚ÑÑ).

| Ð¡Ð¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ | `tg:menu:{chat_id}` | ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° | IME |
|-----------|---------------------|------------|-----|
| **Active** | `message_id` | Ð’Ð¸Ð´Ð½Ð° (is_persistent) | Ð¡ÐºÑ€Ñ‹Ñ‚Ð° |
| **Removed** | âˆ… (ÐºÐ»ÑŽÑ‡ ÑƒÐ´Ð°Ð»Ñ‘Ð½) | Ð¡ÐºÑ€Ñ‹Ñ‚Ð° | ÐÐºÑ‚Ð¸Ð²Ð½Ð° |

ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð°Ð¼ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð²:

| ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ | Ð¯ÐºÐ¾Ñ€ÑŒ Ð´Ð¾ | Ð¯ÐºÐ¾Ñ€ÑŒ Ð¿Ð¾ÑÐ»Ðµ | Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ |
|---------|----------|-------------|----------|
| **A** | Active | Active (Ð½Ð¾Ð²Ñ‹Ð¹) | `_set_menu_id` â†’ send â†’ delete old |
| **B1** | Active | Active (**Ñ‚Ð¾Ñ‚ Ð¶Ðµ**) | ÐÐµ Ñ‚Ñ€Ð¾Ð³Ð°ÐµÑ‚ |
| **B2** | Active | Removed | `_del_menu_id` + delete msg |
| **back_to_reply** | Removed/Active | Active (Ð½Ð¾Ð²Ñ‹Ð¹) | send â†’ `_set_menu_id` â†’ delete old |
| **edit_inline_input** | Active | Removed | delete msg + `_del_menu_id` |
| **show_for_chat** | Active/âˆ… | Active (Ð½Ð¾Ð²Ñ‹Ð¹) | send â†’ `_set_menu_id` â†’ delete old |
| **reset** | Ð»ÑŽÐ±Ð¾Ðµ | Removed | `_del_menu_id` |

**`menu_context`** â€” Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°, Ð¿Ñ€Ð¸Ð²ÑÐ·Ð°Ð½Ð½Ð°Ñ Ðº ÑÐºÐ¾Ñ€ÑŽ.
Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð² `show()`, `back_to_reply()`, `show_for_chat()` Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ `menu_context`.
Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ñ€Ð¾ÑƒÑ‚Ð¸Ð½Ð³Ð° Reply-ÐºÐ½Ð¾Ð¿Ð¾Ðº, ÐºÐ¾Ð³Ð´Ð° Ð¾Ð´Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ° Ð¸Ð¼ÐµÐµÑ‚ Ñ€Ð°Ð·Ð½Ð¾Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ
Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¼ÐµÐ½ÑŽ. ÐžÑ‡Ð¸Ñ‰Ð°ÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ `reset()`.

### 3.6 ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Inline-ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹

Redis key: `tg:inline:{chat_id}` â€” **list** (RPUSH / LRANGE / DEL).

Ð¥Ñ€Ð°Ð½Ð¸Ñ‚ `message_id` Ð²ÑÐµÑ… Inline-ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… Ñ‡ÐµÑ€ÐµÐ· MC.
Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ð¿Ð°ÐºÐµÑ‚Ð½Ð¾Ð³Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ðµ Ð² Reply-Ð¼ÐµÐ½ÑŽ.

**ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ°** (MC Ð´ÐµÐ»Ð°ÐµÑ‚ ÑÐ°Ð¼):

| ÐœÐµÑ‚Ð¾Ð´ | Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ñ inline-ÑÐ¿Ð¸ÑÐºÐ¾Ð¼ |
|-------|--------------------------|
| `show_inline_readonly()` | `_delete_all_inline()` â†’ RPUSH Ð½Ð¾Ð²Ñ‹Ð¹ |
| `show_inline_input()` | `_delete_all_inline()` â†’ RPUSH Ð½Ð¾Ð²Ñ‹Ð¹ |
| `back_to_reply()` | `_delete_all_inline()` (Ð¿Ð¾Ð»Ð½Ð°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ°) |
| `reset()` | `_clear_inline_ids()` (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Redis, Ð±ÐµÐ· ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹) |

**Ð‘ÐµÐ· Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸:**

| ÐœÐµÑ‚Ð¾Ð´ | ÐŸÐ¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ |
|-------|-----------|
| `edit_inline()` | Ð¢Ð¾Ð»ÑŒÐºÐ¾ `edit_text` in place â€” ÑÐ¿Ð¸ÑÐ¾Ðº Ð½Ðµ Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ |
| `edit_inline_input()` | Ð¢Ð¾Ð»ÑŒÐºÐ¾ `edit_text` + ÑƒÐ´Ð°Ð»ÑÐµÑ‚ ÑÐºÐ¾Ñ€ÑŒ â€” ÑÐ¿Ð¸ÑÐ¾Ðº Ð½Ðµ Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ |
| `send_inline_in_flow()` | RPUSH msg_id â€” **Ð½Ðµ ÑƒÐ´Ð°Ð»ÑÐµÑ‚** Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ inline |

**`send_inline_in_flow()`** â€” ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹:
ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Inline Ð¿Ð¾ `chat_id` (Ð±ÐµÐ· Ð¾Ð±ÑŠÐµÐºÑ‚Ð° `Message`) Ð¸ Ñ‚Ñ€ÐµÐºÐ°ÐµÑ‚ ÐµÐ³Ð¾.
ÐÐ• ÑƒÐ´Ð°Ð»ÑÐµÑ‚ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ inline â€” Ð¿Ñ€ÐµÐ´Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½ Ð´Ð»Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ FSM-Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸,
Ð³Ð´Ðµ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Inline Ð¼Ð¾Ð³ÑƒÑ‚ ÑÐ¾ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð¾ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ `back_to_reply()`.

**Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ñ‚Ñ€ÐµÐºÐ¸Ð½Ð³** â€” ÐºÐ¾Ð³Ð´Ð° Inline Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ Ð²Ð½Ðµ MC:

```python
# ÐŸÑ€Ð¸Ð¼ÐµÑ€: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸, ÑÐ¾Ð·Ð´Ð°Ñ‘Ð¼ Ð½Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
msg = await bot.send_message(chat_id, text, reply_markup=kb)
await mc._add_inline_id(chat_id, msg.message_id)  # â† Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾!
```

Ð‘ÐµÐ· Ñ‚Ñ€ÐµÐºÐ¸Ð½Ð³Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑÑ‚Ð°Ð½ÐµÑ‚ÑÑ Ð² Ñ‡Ð°Ñ‚Ðµ Ð¿Ð¾ÑÐ»Ðµ `back_to_reply()`.

---

## 4. Type A â€” Reply â†’ Reply (Ð¾ÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð½Ð°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹ Ð¼ÐµÐ¶Ð´Ñƒ Ð¼ÐµÐ½ÑŽ

### ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ (Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÐ½!)

```
1. old_menu_id = Redis.get(chat_id)
2. user_msg_id = message.message_id

3. msg = send_message(title, ReplyKeyboard)     # Ð¡ÐÐÐ§ÐÐ›Ð Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ!
4. Redis.set(chat_id, msg.id)                   # Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ ÑÐºÐ¾Ñ€ÑŒ

5. if old_menu_id: delete(old_menu_id)          # ÐŸÐžÐ¢ÐžÐœ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ñ‹Ð¹
6. delete(user_msg_id)                          # Ð˜ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
```

### ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ñ‚Ð°ÐºÐ¾Ð¹ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº?

- Ð¨Ð°Ð³ 3: ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° **Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ** Ñƒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
- Ð¨Ð°Ð³Ð¸ 5-6: ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´ÑÑ‚ ÐºÐ¾Ð³Ð´Ð° ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° **ÑƒÐ¶Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°**
- IME Ð½Ðµ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ, Ñ‚.Ðº. ReplyKeyboard ÑƒÐ¶Ðµ Ð½Ð° ÑÐºÑ€Ð°Ð½Ðµ

### Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð² Ñ‡Ð°Ñ‚Ðµ

```
[ Bot: "ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ" + ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° ]
```

ÐžÐ´Ð½Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ. Ð§Ð¸ÑÑ‚Ð¾.

### ÐœÐµÑ‚Ð¾Ð´

```python
await mc.show(message, kb, title="ðŸ“‹")
```

---

## 5. Type B1 â€” Reply â†’ Inline (readonly â€” ÑÐ¿Ð¸ÑÐºÐ¸, Ð²Ñ‹Ð±Ð¾Ñ€)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** Ð¿Ð¾ÐºÐ°Ð· ÑÐ¿Ð¸ÑÐºÐ¾Ð², Ð²Ñ‹Ð±Ð¾Ñ€ Ð¸Ð· Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð², Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð´Ð°Ð½Ð½Ñ‹Ñ…

### ÐšÐ¾Ð³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ

- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¹/ÑƒÑÐ»ÑƒÐ³/ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚Ð¾Ð² Ñ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸ÐµÐ¹
- Ð’Ñ‹Ð±Ð¾Ñ€ Ð¾Ð±ÑŠÐµÐºÑ‚Ð° Ð´Ð»Ñ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°
- Ð›ÑŽÐ±Ð¾Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹, ÐºÐ¾Ð³Ð´Ð° Ð²Ð²Ð¾Ð´ Ñ‚ÐµÐºÑÑ‚Ð° ÐÐ• Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚ÑÑ

### ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼

```
1. user_msg_id = message.message_id

2. send_message(text, InlineKeyboard)           # Inline ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
3. track_inline(msg.id)                         # Ð”Ð»Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸

4. delete(user_msg_id)                          # Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ

# Reply-ÑÐºÐ¾Ñ€ÑŒ ÐÐ• ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ â€” IME Ð½Ðµ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ!
```

### ÐšÐ»ÑŽÑ‡ÐµÐ²Ð¾Ðµ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð¸Ðµ

- Reply-ÑÐºÐ¾Ñ€ÑŒ **Ð¡ÐžÐ¥Ð ÐÐÐ¯Ð•Ð¢Ð¡Ð¯** Ð² Redis
- ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° Ð¾ÑÑ‚Ð°Ñ‘Ñ‚ÑÑ "Ð½Ð° Ð¿Ð°ÑƒÐ·Ðµ" â€” IME Ð½Ðµ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ
- ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¼Ð¾Ð¶ÐµÑ‚ Ð½Ð°Ð¶Ð°Ñ‚ÑŒ ÐºÐ½Ð¾Ð¿ÐºÑƒ Reply (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾)

### Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð² Ñ‡Ð°Ñ‚Ðµ

```
[ Bot: "ðŸ“‹ Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ" + ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° (ÑÐºÑ€Ñ‹Ñ‚Ð° Ð½Ð¾ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°) ]
[ Bot: "ðŸ“ Ð›Ð¾ÐºÐ°Ñ†Ð¸Ð¸ (5)" + inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸ ]
```

### ÐœÐµÑ‚Ð¾Ð´

```python
await mc.show_inline_readonly(message, text, kb)
```

---

## 6. Type B2 â€” Reply â†’ Inline (input â€” Ñ„Ð¾Ñ€Ð¼Ñ‹, Ð²Ð²Ð¾Ð´)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** Ñ„Ð¾Ñ€Ð¼Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ/Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ, Ð²Ð²Ð¾Ð´ Ñ‚ÐµÐºÑÑ‚Ð°

### ÐšÐ¾Ð³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ

- Ð’Ð²Ð¾Ð´ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ, Ð³Ð¾Ñ€Ð¾Ð´Ð°, Ð°Ð´Ñ€ÐµÑÐ°
- Ð›ÑŽÐ±Ð¾Ð¹ FSM wizard step Ñ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¼ Ð²Ð²Ð¾Ð´Ð¾Ð¼
- ÐšÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð”ÐžÐ›Ð–Ð•Ð Ð²Ð²ÐµÑÑ‚Ð¸ Ñ‚ÐµÐºÑÑ‚

### ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼

```
1. old_menu_id = Redis.get(chat_id)
2. user_msg_id = message.message_id

3. send_message(text, InlineKeyboard)           # Inline ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
4. track_inline(msg.id)                         # Ð”Ð»Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸

5. delete(user_msg_id)                          # Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
6. if old_menu_id: delete(old_menu_id)          # Ð£Ð”ÐÐ›Ð˜Ð¢Ð¬ Reply-ÑÐºÐ¾Ñ€ÑŒ!
7. Redis.delete(chat_id)                        # ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ ÑÐºÐ¾Ñ€ÑŒ Ð² Redis
```

### ÐšÐ»ÑŽÑ‡ÐµÐ²Ð¾Ðµ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð¸Ðµ

- Reply-ÑÐºÐ¾Ñ€ÑŒ **Ð£Ð”ÐÐ›Ð¯Ð•Ð¢Ð¡Ð¯**
- IME **Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ** â€” Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð³Ð¾Ñ‚Ð¾Ð² Ð²Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑÑ‚
- ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° ÑÐºÑ€Ñ‹Ñ‚Ð° Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ

### Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð² Ñ‡Ð°Ñ‚Ðµ

```
[ Bot: "âž• ÐÐ¾Ð²Ð°Ñ Ð»Ð¾ÐºÐ°Ñ†Ð¸Ñ\n\nÐ’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ:" + inline-ÐºÐ½Ð¾Ð¿ÐºÐ° ÐžÑ‚Ð¼ÐµÐ½Ð° ]
[ ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð²Ð¸Ð´Ð¸Ñ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½ÑƒÑŽ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ Ð´Ð»Ñ Ð²Ð²Ð¾Ð´Ð° ]
```

### ÐœÐµÑ‚Ð¾Ð´

```python
await mc.show_inline_input(message, text, kb)
```

---

## 7. Type C â€” Reply â†’ Reply Ñ Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼ (FSM/wizard)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** Ð¿Ð¾ÑˆÐ°Ð³Ð¾Ð²Ñ‹Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ñ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼Ð¸

### ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼

```
1. old_menu_id = Redis.get(chat_id)
2. if old_menu_id: delete(old_menu_id)

3. msg = send_message(question_text, ReplyKeyboard)
4. Redis.set(chat_id, msg.id)
```

### ÐžÑ‚Ð»Ð¸Ñ‡Ð¸Ðµ Ð¾Ñ‚ Type A

- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ **ÐÐ• ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ** (Ð½ÑƒÐ¶ÐµÐ½ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚)
- Ð¢ÐµÐºÑÑ‚ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð²Ð¾Ð¿Ñ€Ð¾Ñ/Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑŽ

---

## 8. Inline â†’ Inline + IME (Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ Ðº Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÑŽ)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð°Ð¶Ð°Ð» "âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ" Ð² ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐµ

### ÐšÐ¾Ð³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ

ÐŸÐ¾ÑÐ»Ðµ `show_inline_readonly` (B1) Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ:
1. Ð’Ñ‹Ð±Ñ€Ð°Ð» Ð¿ÑƒÐ½ÐºÑ‚ Ð¸Ð· ÑÐ¿Ð¸ÑÐºÐ° â†’ `edit_inline()` (ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ°)
2. ÐÐ°Ð¶Ð°Ð» "Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ" â†’ `edit_inline_input()` (IME Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÑ‚ÑÑ)

### ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼

```
1. edit_text(text, InlineKeyboard)              # ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
2. old_menu_id = Redis.get(chat_id)
3. if old_menu_id: delete(old_menu_id)          # Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Reply-ÑÐºÐ¾Ñ€ÑŒ
4. Redis.delete(chat_id)                        # ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð² Redis
```

### ÐœÐµÑ‚Ð¾Ð´

```python
await mc.edit_inline_input(callback.message, text, kb)
```

---

## 9. Inline â†’ Reply (Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð¸Ð· ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ)

```
1. send_message(title, ReplyKeyboard)           # Ð¡ÐÐÐ§ÐÐ›Ð Ð½Ð¾Ð²Ñ‹Ð¹ ÑÐºÐ¾Ñ€ÑŒ
2. Redis.set(chat_id, msg.id)
3. delete_all_inline()                          # Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð’Ð¡Ð• tracked inline
```

### ÐœÐµÑ‚Ð¾Ð´

```python
await mc.back_to_reply(callback.message, kb, title="ðŸ“‹")
```

---

## 10. Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ñ‚Ð¸Ð¿Ð°

| Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ | Ð¢Ð¸Ð¿ | Reply-ÑÐºÐ¾Ñ€ÑŒ | IME | ÐœÐµÑ‚Ð¾Ð´ |
|----------|-----|-------------|-----|-------|
| ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ð¼ÐµÐ¶Ð´Ñƒ Ð¼ÐµÐ½ÑŽ | A | ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ÑÑ | ÐÐµÑ‚ | `show()` |
| ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº | B1 | Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ | ÐÐµÑ‚ | `show_inline_readonly()` |
| Ð¤Ð¾Ñ€Ð¼Ð° Ð²Ð²Ð¾Ð´Ð° (Ð¸Ð· Reply) | B2 | Ð£Ð´Ð°Ð»ÑÐµÑ‚ÑÑ | Ð”Ð° | `show_inline_input()` |
| ÐŸÐ°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ/Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ | â€” | ÐÐµ Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ | ÐÐµÑ‚ | `edit_inline()` |
| Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ (Ð¸Ð· Inline) | â€” | Ð£Ð´Ð°Ð»ÑÐµÑ‚ÑÑ | Ð”Ð° | `edit_inline_input()` |
| Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð² Ð¼ÐµÐ½ÑŽ | â€” | Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ñ‚ÑÑ | ÐÐµÑ‚ | `back_to_reply()` |

---

## 11. ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ

### Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¹ (B1)

```python
# Ð’ handlers/admin_reply.py
elif text == t("admin:locations:list", lang):
    await loc_flow.show_list(message)

# Ð’ flows/admin/locations.py
async def show_list(self, message: Message):
    locations = await api.get_locations()
    kb = locations_list_inline(locations, 0, lang)
    
    # B1: Reply-ÑÐºÐ¾Ñ€ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ, IME Ð½Ðµ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ
    await self.mc.show_inline_readonly(
        message, 
        t("admin:locations:list_title", lang) % len(locations),
        kb
    )
```

### Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¸ (B2)

```python
async def start_create(self, message: Message, state: FSMContext):
    await state.set_state(LocationCreate.name)
    
    # B2: Reply-ÑÐºÐ¾Ñ€ÑŒ ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ, IME Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð´Ð»Ñ Ð²Ð²Ð¾Ð´Ð°
    await self.mc.show_inline_input(
        message,
        t("admin:location:enter_name", lang),
        cancel_inline(lang)
    )
```

### Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð· ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ (edit_inline_input)

```python
@router.callback_query(F.data.startswith("loc:edit:"))
async def edit_location(callback: CallbackQuery, state: FSMContext):
    loc_id = int(callback.data.split(":")[2])
    lang = user_lang.get(callback.from_user.id, DEFAULT_LANG)
    
    await state.set_state(LocationEdit.name)
    await state.update_data(loc_id=loc_id)
    
    # ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ðº Ð²Ð²Ð¾Ð´Ñƒ â€” IME Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÑ‚ÑÑ
    await mc.edit_inline_input(
        callback.message,
        t("admin:location:edit_name", lang),
        cancel_inline(lang)
    )
    await callback.answer()
```

---

## 12. Ð¡Ñ‚Ñ€Ð¾Ð³Ð¸Ðµ Ð·Ð°Ð¿Ñ€ÐµÑ‚Ñ‹

| Ð—Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½Ð¾                              | ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ                        | Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ                  |
| -------------------------------------- | ----------------------------- | ----------------------------- |
| `ReplyKeyboardRemove` Ð¼ÐµÐ¶Ð´Ñƒ Ð¼ÐµÐ½ÑŽ       | Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¸Ñ‚ IME                 | `mc.show()` |
| Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð”Ðž Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¼ÐµÐ½ÑŽ       | Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¸Ñ‚ IME                 | ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº: send â†’ delete |
| ZWS ÐºÐ°Ðº Ñ‚ÐµÐºÑÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ                | API Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÑÐµÑ‚                 | Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº/emoji |
| `is_persistent=False`                  | ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° ÑÑ…Ð»Ð¾Ð¿Ñ‹Ð²Ð°ÐµÑ‚ÑÑ       | `is_persistent=True` |
| ÐÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐºÐ¾Ñ€ÐµÐ¹ Ð² Redis               | ÐÐµÐ¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ð¾Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ      | Ð˜Ð½Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Â§3.5 |
| B1 Ð´Ð»Ñ Ñ„Ð¾Ñ€Ð¼ Ð²Ð²Ð¾Ð´Ð°                      | IME Ð½Ðµ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ               | `show_inline_input()` |
| B2 Ð´Ð»Ñ ÑÐ¿Ð¸ÑÐºÐ¾Ð² Ð²Ñ‹Ð±Ð¾Ñ€Ð°                  | IME Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ Ð±ÐµÐ· Ð½Ð°Ð´Ð¾Ð±Ð½Ð¾ÑÑ‚Ð¸   | `show_inline_readonly()` |
| `edit_inline` Ð´Ð»Ñ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ       | IME Ð½Ðµ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ               | `edit_inline_input()` |
| `callback.message.edit_text()` Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ | ÐžÐ±Ñ…Ð¾Ð´Ð¸Ñ‚ MC, Ð»Ð¾Ð¼Ð°ÐµÑ‚ Ñ‚Ñ€ÐµÐºÐ¸Ð½Ð³    | `mc.edit_inline()` |
| `callback.message.edit_reply_markup()` Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ | ÐžÐ±Ñ…Ð¾Ð´Ð¸Ñ‚ MC                    | `mc.edit_inline()` |
| Ð¥Ð°Ñ€Ð´ÐºÐ¾Ð´ emoji `â—€ï¸`/`â–¶ï¸` Ð´Ð»Ñ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ð¸ | ÐÐ°Ñ€ÑƒÑˆÐ°ÐµÑ‚ i18n                 | `t("common:prev/next", lang)` |

---

## 13. Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÐºÐ¾Ð´Ð°

```
bot/app/
â”œâ”€â”€ main.py                    # dp, bot, process_update, route_by_role
â”œâ”€â”€ keyboards/
â”‚   â””â”€â”€ admin.py               # Ð¤ÐžÐ ÐœÐ: ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÐºÐ½Ð¾Ð¿Ð¾Ðº (is_persistent=True)
â”œâ”€â”€ flows/
â”‚   â””â”€â”€ admin/
â”‚       â””â”€â”€ menu.py            # Ð›ÐžÐ“Ð˜ÐšÐ: ÐºÐ°ÐºÐ¾Ðµ Ð¼ÐµÐ½ÑŽ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ
â”œâ”€â”€ handlers/
â”‚   â””â”€â”€ admin_reply.py         # Ð ÐžÐ£Ð¢Ð˜ÐÐ“: text â†’ flow action
â””â”€â”€ utils/
    â””â”€â”€ menucontroller.py      # Ð¢Ð ÐÐÐ¡ÐŸÐžÐ Ð¢: send/delete, Redis
```

---

## 14. Ð§ÐµÐºÐ»Ð¸ÑÑ‚ Ð´Ð»Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÐºÐ¾Ð´Ð°

- [ ] `is_persistent=True` Ð² ReplyKeyboard?
- [ ] Ð¢ÐµÐºÑÑ‚ Ð½ÐµÐ¿ÑƒÑÑ‚Ð¾Ð¹ (Ð½Ðµ ZWS)?
- [ ] ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº: send â†’ delete?
- [ ] ÐžÐ´Ð¸Ð½ ÑÐºÐ¾Ñ€ÑŒ Ð² Redis?
- [ ] Ð¡Ð¿Ð¸ÑÐ¾Ðº/Ð²Ñ‹Ð±Ð¾Ñ€ â†’ `show_inline_readonly()`?
- [ ] Ð¤Ð¾Ñ€Ð¼Ð°/Ð²Ð²Ð¾Ð´ Ð¸Ð· Reply â†’ `show_inline_input()`?
- [ ] Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð· Inline â†’ `edit_inline_input()`?
- [ ] Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ â†’ `back_to_reply()`?
- [ ] ÐŸÐ°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ: Ñ‚ÐµÐºÑÑ‚ ÐºÐ½Ð¾Ð¿Ð¾Ðº Ñ‡ÐµÑ€ÐµÐ· i18n (`common:prev`, `common:next`)?
- [ ] ÐŸÐ°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ: Ñ€Ð¾Ð²Ð½Ð¾ 3 ÐºÐ½Ð¾Ð¿ÐºÐ¸ `[prev | counter | next]`?
- [ ] ÐŸÐ°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ: ÑÐ¼ÐµÐ½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ñ‡ÐµÑ€ÐµÐ· `mc.edit_inline()`, Ð½Ðµ `callback.message.edit_text()`?
- [ ] ÐÐ¾Ð²Ð¾Ðµ Inline-ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð²Ð½Ðµ MC â†’ `mc._add_inline_id()` Ð´Ð»Ñ Ñ‚Ñ€ÐµÐºÐ¸Ð½Ð³Ð°?
- [ ] Ð’Ñ‹Ñ…Ð¾Ð´ Ð¸Ð· Inline-ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ â†’ `mc.back_to_reply()` (Ð½Ðµ `mc.show()`)?

---

## 15. Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ð¸

> Ð­Ñ‚Ð°Ð»Ð¾Ð½Ð½Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ: `bot/app/flows/admin/services.py`, Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ `services_list_inline()`.

### 15.1 ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹

| ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ | Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ | ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹ |
|----------|----------|-------------|
| `PAGE_SIZE` | 5 | ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð° Ð² ÐºÐ°Ð¶Ð´Ð¾Ð¼ Ñ„Ð°Ð¹Ð»Ðµ |
| ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ | Ñ€Ð¾Ð²Ð½Ð¾ **3 ÐºÐ½Ð¾Ð¿ÐºÐ¸** Ð² Ñ€ÑÐ´ | `[prev \| counter \| next]` |
| Ð¢ÐµÐºÑÑ‚ prev | `t("common:prev", lang)` | i18n, Ð½Ðµ emoji |
| Ð¢ÐµÐºÑÑ‚ next | `t("common:next", lang)` | i18n, Ð½Ðµ emoji |
| Ð¢ÐµÐºÑÑ‚ counter | `f"{page + 1}/{total_pages}"` | Ð’ÑÐµÐ³Ð´Ð° Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÐµÑ‚ÑÑ |
| Disabled ÐºÐ½Ð¾Ð¿ÐºÐ° | `text=" "`, `callback_data="{prefix}:noop"` | ÐŸÑ€Ð¾Ð±ÐµÐ» + noop |
| ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ ÑÐºÑ€Ñ‹Ñ‚Ð° | Ð¿Ñ€Ð¸ `total_pages == 1` | Ð ÑÐ´ Ð½Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ÑÑ |
| Callback format | `{prefix}:page:{page}` | 0-based page |

### 15.2 Ð¨Ð°Ð±Ð»Ð¾Ð½ ÐºÐ½Ð¾Ð¿Ð¾Ðº

```python
if total_pages > 1:
    nav_row = []

    if page > 0:
        nav_row.append(InlineKeyboardButton(
            text=t("common:prev", lang),
            callback_data=f"{prefix}:page:{page - 1}"
        ))
    else:
        nav_row.append(InlineKeyboardButton(
            text=" ", callback_data=f"{prefix}:noop"
        ))

    nav_row.append(InlineKeyboardButton(
        text=f"{page + 1}/{total_pages}",
        callback_data=f"{prefix}:noop"
    ))

    if page < total_pages - 1:
        nav_row.append(InlineKeyboardButton(
            text=t("common:next", lang),
            callback_data=f"{prefix}:page:{page + 1}"
        ))
    else:
        nav_row.append(InlineKeyboardButton(
            text=" ", callback_data=f"{prefix}:noop"
        ))

    buttons.append(nav_row)
```

### 15.3 MC-Ð¼ÐµÑ‚Ð¾Ð´ Ð¿Ð¾ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸

| ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ñ | MC-Ð¼ÐµÑ‚Ð¾Ð´ | ÐŸÑ€Ð¸Ð¼ÐµÑ€ |
|----------|----------|--------|
| ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð¿Ð¾ÐºÐ°Ð· ÑÐ¿Ð¸ÑÐºÐ° | `mc.show_inline_readonly()` | Reply â†’ ÑÐ¿Ð¸ÑÐ¾Ðº |
| Ð¡Ð¼ÐµÐ½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ | `mc.edit_inline()` | callback â†’ edit in place |
| ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ / ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ / Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ | `mc.edit_inline()` | callback â†’ edit in place |
| Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð² Reply-Ð¼ÐµÐ½ÑŽ | `mc.back_to_reply()` | ÐºÐ½Ð¾Ð¿ÐºÐ° Â«ÐÐ°Ð·Ð°Ð´Â» |

### 15.4 Ð—Ð°Ð¿Ñ€ÐµÑ‰Ñ‘Ð½Ð½Ñ‹Ðµ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹

| ÐŸÐ°Ñ‚Ñ‚ÐµÑ€Ð½ | ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° | Ð¤Ð°Ð¹Ð»Ñ‹ (Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ) |
|---------|----------|--------------------------|
| Emoji `â—€ï¸`/`â–¶ï¸` Ð²Ð¼ÐµÑÑ‚Ð¾ i18n | ÐÐ°Ñ€ÑƒÑˆÐ°ÐµÑ‚ ÐµÐ´Ð¸Ð½Ñ‹Ð¹ ÑÑ‚Ð¸Ð»ÑŒ, Ð½Ðµ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ñ‚ÑÑ | locations, specialists, specialists_edit, rooms, rooms_edit, clients_booking, clients_bookings_list, clients_find, clients_sell_package, clients_wallets, schedule_overrides, client/booking, client/my_bookings |
| ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ðµ ÐºÐ¾Ð»-Ð²Ð¾ ÐºÐ½Ð¾Ð¿Ð¾Ðº (1-2) | ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð¿Ñ€Ñ‹Ð³Ð°ÑŽÑ‚, Ð½ÐµÑ‚ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸ÐºÐ° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ† | packages, packages_edit |
| ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸ÐºÐ° `page/total` | ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð·Ð½Ð°ÐµÑ‚ ÐºÐ¾Ð»-Ð²Ð¾ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ† | packages, packages_edit |
| `callback.message.edit_text()` Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ | ÐžÐ±Ñ…Ð¾Ð´Ð¸Ñ‚ MC, Ñ‚ÐµÑ€ÑÐµÑ‚ Ñ‚Ñ€ÐµÐºÐ¸Ð½Ð³ | booking_edit (~9), client/booking (~6), locations_edit (~3), specialists (~12), locations (~3), booking_notify (~2), packages_edit (~3), specialists_edit (~5), rooms_edit (~2), rooms (~4), services (~2) |

### 15.5 Ð§ÐµÐºÐ»Ð¸ÑÑ‚ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

**Emoji â†’ i18n** (Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ `â—€ï¸`/`â–¶ï¸` Ð½Ð° `t("common:prev/next", lang)`):

- [ ] `flows/admin/locations.py`
- [ ] `flows/admin/specialists.py`
- [ ] `flows/admin/specialists_edit.py`
- [ ] `flows/admin/rooms.py`
- [ ] `flows/admin/rooms_edit.py`
- [ ] `flows/admin/clients_booking.py`
- [ ] `flows/admin/clients_bookings_list.py`
- [ ] `flows/admin/clients_find.py`
- [ ] `flows/admin/clients_sell_package.py`
- [ ] `flows/admin/clients_wallets.py`
- [ ] `flows/admin/schedule_overrides.py`
- [ ] `flows/client/booking.py`
- [ ] `flows/client/my_bookings.py`

**Variable buttons â†’ 3 Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ…** (Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ disabled + counter):

- [ ] `flows/admin/packages.py` (list + create)
- [ ] `flows/admin/packages_edit.py`

**`callback.message.edit_text()` â†’ `mc.edit_inline()`** (~54 Ð¼ÐµÑÑ‚Ð°):

- [ ] `flows/common/booking_edit.py` (~9)
- [ ] `flows/client/booking.py` (~6)
- [ ] `flows/admin/locations.py` (~3)
- [ ] `flows/admin/locations_edit.py` (~3)
- [ ] `flows/admin/specialists.py` (~12)
- [ ] `flows/admin/specialists_edit.py` (~5)
- [ ] `flows/admin/rooms.py` (~4)
- [ ] `flows/admin/rooms_edit.py` (~2)
- [ ] `flows/admin/packages_edit.py` (~3)
- [ ] `flows/admin/booking_notify.py` (~2)
- [ ] `flows/admin/services.py` (~2)
- [ ] `flows/admin/schedule_bookings.py` (Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ)

---

## 16. Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹

| Ð’ÐµÑ€ÑÐ¸Ñ | Ð”Ð°Ñ‚Ð°       | Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ                                    |
| ------ | ---------- | -------------------------------------------- |
| 1.0    | 2024-12    | ÐŸÐµÑ€Ð²Ð¾Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚                      |
| 2.0    | 2024-12-26 | ZWS Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, is_persistent Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½    |
| 2.1    | 2024-12-28 | Type B Ñ€Ð°Ð·Ð´ÐµÐ»Ñ‘Ð½ Ð½Ð° B1 (readonly) Ð¸ B2 (input)|
| 2.2    | 2024-12-28 | Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ edit_inline_input Ð´Ð»Ñ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ|
| 3.0    | 2026-02-15 | ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ, ÑÐºÐ¾Ñ€ÑŒ, inline cleanup, ÐµÐ´Ð¸Ð½Ð°Ñ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ, Ñ‡ÐµÐºÐ»Ð¸ÑÑ‚ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ |

