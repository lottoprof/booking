# üìê –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ö–µ–º–∞–º–∏ –ë–î (PostgreSQL ‚Üê‚Üí SQLite ‚Üê‚Üí ORM)

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ ‚Äî **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
–õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –¥–µ–ª–∞—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –ø–æ —ç—Ç–æ–º—É —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É.

---

# –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã 

## 1. –ò–∑–º–µ–Ω–∏—Ç—å PostgreSQL-—Å—Ö–µ–º—É
–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º **schema_psql.sql** –≤—Ä—É—á–Ω—É—é.

–ó–∞–ø—Ä–µ—â–µ–Ω–æ:
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SERIAL, BOOLEAN, JSONB, NUMERIC ‚Äî —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–µ —Ç–∏–ø—ã
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PSQL-—Ñ—É–Ω–∫—Ü–∏–∏ (now(), uuid_generate(), triggers)
- –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ SQLite-–≤–µ—Ä—Å–∏—é

PSQL ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞, SQLite ‚Äî –µ—ë –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ.

---

## 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å schema_sqlite.sql
–ü—Ä–∏–≤–µ—Å—Ç–∏ **schema_sqlite.sql** –∫ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç—É PSQL:

- SERIAL ‚Üí INTEGER PRIMARY KEY AUTOINCREMENT  
- BOOLEAN ‚Üí INTEGER (0/1)  
- NUMERIC ‚Üí REAL  
- JSONB ‚Üí TEXT  
- TIMESTAMP DEFAULT now() ‚Üí TEXT DEFAULT CURRENT_TIMESTAMP  
- DATE ‚Üí TEXT  

SQLite-–≤–µ—Ä—Å–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É PostgreSQL, –Ω–æ –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Ç–∏–ø–∞—Ö.

---

## 3. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é SQLite-–±–∞–∑—É

```bash
rm -f data/sqlite/booking.db
sqlite3 data/sqlite/booking.db < schema/schema_sqlite.sql


## 4. –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å ORM-–º–æ–¥–µ–ª–∏

> ORM –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è. –í—Ä—É—á–Ω—É—é –µ–≥–æ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º.

```
sqlacodegen sqlite:///data/sqlite/booking.db \
    --outfile backend/app/models/generated.py
```

## 5. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Alembic

```
cd backend
alembic revision --autogenerate -m "update schema"
```

‚Üí Alembic —Å–æ–∑–¥–∞—Å—Ç diff –º–µ–∂–¥—É PostgreSQL –∏ ORM.

## –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Ä—É–∫–∞–º–∏

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
- –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
- –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö ALTER
- –Ω–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

## 6. –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```
alembic upgrade head
```

## TO DO
- –¥–æ–±–∞–≤–∏—Ç—å CI-–ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ö–µ–º—ã,
- —Å–¥–µ–ª–∞—Ç—å Makefile,
- –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é SQLite + ORM –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.
