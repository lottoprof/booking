# ü§ñ Telegram-–±–æ—Ç —Å–∏—Å—Ç–µ–º—ã –∑–∞–ø–∏—Å–∏ ‚Äî —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

## 1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–æ—Ç–∞

Telegram-–±–æ—Ç ‚Äî **–µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –¥–æ—Å—Ç—É–ø–∞** –∫ —Å–∏—Å—Ç–µ–º–µ –∑–∞–ø–∏—Å–∏ –≤ Telegram.

–ë–æ—Ç:
- **–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏**
- **–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å –ë–î**
- —Ä–∞–±–æ—Ç–∞–µ—Ç **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ FastAPI**
- –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç **–æ–¥–Ω—É –∫–æ–º–ø–∞–Ω–∏—é**
- –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–æ–ª—è–º

---

## 2. –ë–∞–∑–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–û–¥–∏–Ω –±–æ—Ç ‚Üí –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è**
- `company_id`:
  - –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –±–æ—Ç—É –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (env / config) –∏–ª–∏ id –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –µ–¥–∏–Ω–æ–∂–¥—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏. –ü–æ—Å–ª–µ–¥—É—é—â–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ —Ä—É—á–Ω—É—é.
  - –Ω–µ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∏ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –ê–¥–º–∏–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç **—Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –±–æ—Ç–µ**
- Redis –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è backend‚Äô–æ–º –∏ –±–æ—Ç–æ–º (–±–æ—Ç ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è UI-—Å–æ—Å—Ç–æ—è–Ω–∏—è, –Ω–µ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏)
- –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç—Ä–æ–≥–æ –ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É `API.md`

## 2.1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã (bootstrap)

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏:
- –ø—É—Å—Ç–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

–î–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è bootstrap-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è.

–ü—Ä–∏–Ω—Ü–∏–ø:
- `ADMIN_TG_ID` –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `.env`
- –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ backend –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
- –±–æ—Ç –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç
- Redis –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

–ê–ª–≥–æ—Ä–∏—Ç–º bootstrap:
1. –°—á–∏—Ç–∞—Ç—å `ADMIN_TG_ID` –∏–∑ `.env`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î
3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ—Ç:
   - —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
   - —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –Ω–∞–∑–Ω–∞—á–∏—Ç—å –µ–º—É —Ä–æ–ª—å `admin`
4. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ—Å—Ç—å:
   - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ admin —Å –¥–∞–Ω–Ω—ã–º `tg_id`
   - –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ admin
   - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞–¥–º–∏–Ω—ã –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ backend / bot)

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:
- –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º
- –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞
- –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ runtime

## 2.2. Audit –∏ bootstrap-—Å–æ–±—ã—Ç–∏—è

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–ª—è–º–∏
—Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ `audit_log`.

Audit –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
- –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è bootstrap-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- —Ñ–∏–∫—Å–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

Telegram-–±–æ—Ç:
- –Ω–µ –ø–∏—à–µ—Ç audit –Ω–∞–ø—Ä—è–º—É—é
- –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç audit-—Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ backend API

---

## 3. –†–æ–ª–∏ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 3.1 Admin

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**
- –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤
- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏
- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑—è–º–∏
- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏
- —Å–ª—É–∂–µ–±–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
- –ø–æ `tg_id`
- –ø–µ—Ä–≤–∏—á–Ω—ã–π `tg_id` –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `.env`
- –ø—Ä–∏–≤—è–∑–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è bootstrap-—Å–∫—Ä–∏–ø—Ç–æ–º
- –¥–∞–ª—å–Ω–µ–π—à–µ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ API
- —Å–º–µ–Ω–∞ `tg_id` —á–µ—Ä–µ–∑ API –∑–∞–ø—Ä–µ—â–µ–Ω–∞

**–§—É–Ω–∫—Ü–∏–∏**
- locations / rooms / services / service_packages
- specialists (–ø—Ä–æ—Ñ–∏–ª—å, –≥—Ä–∞—Ñ–∏–∫)
- specialist ‚Üî services (domain API)
- calendar_overrides
- –∫–æ—à–µ–ª—ë–∫ –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî **—Ç–æ–ª—å–∫–æ domain wallet API**
- –ø—Ä–æ—Å–º–æ—Ç—Ä / —Å–ª—É–∂–µ–±–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

---

### 3.2 Specialist

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**
- —á—Ç–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –∑–∞–ø–∏—Å–µ–π

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
- —Ç–æ–ª—å–∫–æ –ø–æ `tg_id`
- –∂—ë—Å—Ç–∫–∞—è —Å–≤—è–∑—å `tg_id ‚Üí users.id`
- —Å–º–µ–Ω–∞ `tg_id` –∑–∞–ø—Ä–µ—â–µ–Ω–∞

**–§—É–Ω–∫—Ü–∏–∏ (v1)**
- –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö booking
- –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

---

### 3.3 Client

**–°—Ç–∞—Ç—É—Å**
- —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–¥–æ—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∑–∂–µ)

**–í—Ö–æ–¥—ã**
- Web: –∏–º—è + —Ç–µ–ª–µ—Ñ–æ–Ω
- Telegram / Mini App: `tg_id`

**–ë—É–¥—É—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏**
- –∑–∞–ø–∏—Å—å
- –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–µ–π
- –æ—Ç–º–µ–Ω–∞

---

## 4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –±–æ—Ç—É
2. –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç `tg_id`
3. API:
   - –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `tg_id`
4. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω:
   - —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é `client`
5. –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `user_roles`
6. –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π:
   - admin / specialist / client

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
- bootstrap-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –î–û –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ –≤ –±–æ—Ç
- –±–æ—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
- –±–æ—Ç –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

## 4.1 –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ gateway

–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ gateway, –ù–ï –≤ –±–æ—Ç–µ.

–ü–æ—Ç–æ–∫:
1. Telegram ‚Üí gateway `/tg/webhook`
2. gateway: extract_tg_id(update)
3. gateway: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ Redis `tg_user:{tg_id}` (TTL 10 –º–∏–Ω)
4. –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫—ç—à–µ ‚Üí –∑–∞–ø—Ä–æ—Å –∫ backend:
   - GET /users/by_tg/{tg_id}
   - –ï—Å–ª–∏ 404 ‚Üí —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + —Ä–æ–ª—å client
5. gateway –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ bot: TgUserContext(tg_id, user_id, company_id, role)
6. bot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç role —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–±–µ–∑ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤)

–ë–æ—Ç:
- –ù–ï –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ backend –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ø–æ–ª—É—á–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç gateway
- —É–¥–∞–ª–∏—Ç—å bot/app/auth.py

---

## 5. –†–∞–±–æ—Ç–∞ —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏

### –ü—Ä–∏–Ω—Ü–∏–ø
- **–û—Ç–∫—Ä—ã—Ç–∞—è –∑–∞–ø–∏—Å—å**
- –ë–æ—Ç **–Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ª–æ—Ç—ã**
- –ë–æ—Ç **–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Redis**

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `POST /bookings` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –≤–Ω—É—Ç—Ä–∏ backend:
  - Redis-lock
  - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ—Ç–æ–≤
- –±–µ–∑ Redis —Å–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ

–ë–æ—Ç:
- –≤—ã–∑—ã–≤–∞–µ—Ç API
- –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –Ω–µ –∑–Ω–∞–µ—Ç –æ –º–µ—Ö–∞–Ω–∏–∫–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

---

## 6. –°–≤—è–∑—å Specialist ‚Üî Services

- –¢–∏–ø —Å–≤—è–∑–∏: **M:N**
- –¢–∞–±–ª–∏—Ü–∞: `specialist_services`
- –û—Ç–¥–µ–ª—å–Ω–æ–≥–æ CRUD-—Ä–µ—Å—É—Ä—Å–∞ **–Ω–µ—Ç**
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–æ–º–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:

```
GET /specialists/{id}/services
POST /specialists/{id}/services
PATCH /specialists/{id}/services/{service_id}
DELETE /specialists/{id}/services/{service_id}
```


- Soft-delete —á–µ—Ä–µ–∑ `is_active`

---

## 7. –§–∏–Ω–∞–Ω—Å—ã (–∫–æ—à–µ–ª—ë–∫)

- CRUD –∫–æ—à–µ–ª—å–∫–∞ –∑–∞–ø—Ä–µ—â—ë–Ω
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ domain API**:

```
GET /wallets/{user_id}
GET /wallets/{user_id}/transactions
POST /wallets/{user_id}/deposit
POST /wallets/{user_id}/withdraw
POST /wallets/{user_id}/payment
POST /wallets/{user_id}/refund
POST /wallets/{user_id}/correction
```

–ë–æ—Ç:
- –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç –±–∞–ª–∞–Ω—Å –Ω–∞–ø—Ä—è–º—É—é
- –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `wallet_transactions`

---

## 8. –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –ø–µ—Ä–µ—Å—á—ë—Ç —Å–ª–æ—Ç–æ–≤

- –ü–æ—Å–ª–µ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤:
  - backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞–µ—Ç —Å–ª–æ—Ç—ã –Ω–∞ **60 –¥–Ω–µ–π**
- –ß–µ—Ä–µ–∑ –±–æ—Ç–∞:
  - **—Ç–æ–ª—å–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏** (overrides)
- –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:
  - —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –ø–µ—Ä–µ—Å—á—ë—Ç –Ω–∞ backend
- Redis ‚Äî runtime —Å–ª–æ–π, –±–æ—Ç –µ–≥–æ –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç

---

## 9. –ü—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–µ—Ç—ã

–ë–æ—Ç **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ**:
- –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ë–î –Ω–∞–ø—Ä—è–º—É—é
- —Å—á–∏—Ç–∞–µ—Ç —Å–ª–æ—Ç—ã
- –º–µ–Ω—è–µ—Ç –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ CRUD
- –º–µ–Ω—è–µ—Ç `tg_id`
- –æ–±—Ö–æ–¥–∏—Ç API.md

---

## 10. –ò—Ç–æ–≥

bootstrap –∏ –Ω–∞—á–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–Ω–µ –±–æ—Ç–∞ (—Å–∫—Ä–∏–ø—Ç–æ–º)

Telegram-–±–æ—Ç:
- UI + –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è + –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
- —Å—Ç—Ä–æ–≥–∏–π –∫–ª–∏–µ–Ω—Ç FastAPI
- –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è
- —Ç—Ä–∏ —Ä–æ–ª–∏
- –Ω—É–ª–µ–≤–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

## 11. –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

Telegram-–±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç: 
- *ReplyKeyboardMarkup* ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ (–æ–±—ã—á–Ω–∞—è) –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–µ–Ω—é.
- *InlineKeyboardMarkup* ‚Äî –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–µ—Ä–≤–∏—Å–æ–º

–ü—Ä–∏–Ω—Ü–∏–ø—ã:

- reply-–∫–Ω–æ–ø–∫–∞ –≤—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –±–æ—Ç **–Ω–µ –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∫–∞–∫ –Ω–∞ ‚Äú–∫–æ–º–∞–Ω–¥—É‚Äù**
- –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π router –ø–æ `message.text`
- –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è **–ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–∏**
- —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏  –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω i18n

–í–∞–∂–Ω–æ:

- —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —á–∏—Å—Ç–æ–≥–æ UI
- —Å–º–µ–Ω–∞ –º–µ–Ω—é —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑:
  - `ReplyKeyboardRemove()`
  - –ø–æ—Å–ª–µ–¥—É—é—â—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–æ–≤–æ–π reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

–ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π –∏ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ UI-—Å–ª–æ—é –±–æ—Ç–∞.

### –¢–∏–ø—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫

#### ReplyKeyboardMarkup

–¢–∏–ø A ‚Äî –ù–∞–≤–∏–≥–∞—Ü–∏—è (–æ—Å–Ω–æ–≤–Ω–æ–π –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
- Reply ‚Üí Reply
- —Å–º–µ–Ω–∞ –º–µ–Ω—é
- –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏

–¢–∏–ø B ‚Äî –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞
- Reply ‚Üí Inline
- –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–µ–Ω—é
- –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é

–¢–∏–ø C ‚Äî –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –≤—ã–±–æ—Ä (—Ä–µ–¥–∫–∏–π)
- Reply ‚Üí Reply
- —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ—à–∞–≥–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –≤—ã–±–æ—Ä–∞ –∑–Ω–∞—á–µ–Ω–∏–π


> –î–ª—è ‚Äú—á–∏—Å—Ç–æ–≥–æ —á–∞—Ç–∞‚Äù –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ Reply ‚Üí Reply —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å  `last_menu_message_id` (message_id –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–µ–Ω—é-—Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞) –∏ —É–¥–∞–ª—è—Ç—å –µ–≥–æ –ø—Ä–∏ —Å–º–µ–Ω–µ –º–µ–Ω—é.
> –≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º UI-—Å–ª–æ—è (MenuController) –∏ –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ FSM.


#### InlineKeyboardMarkup

–¢–∏–ø 1 ‚Äî –° —É–¥–∞–ª–µ–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è (–æ—Å–Ω–æ–≤–Ω–æ–π –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
- callback ‚Üí delete_message
- –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

–¢–∏–ø 2 ‚Äî –ë–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è
- callback ‚Üí edit_message_text / edit_message_reply_markup
- –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏


–ù–∞–≤–∏–≥–∞—Ü–∏—è Telegram-–±–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ MenuController.

Handlers:
- —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π
- –Ω–µ —É–ø—Ä–∞–≤–ª—è—é—Ç —É–¥–∞–ª–µ–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π
- –Ω–µ —Ö—Ä–∞–Ω—è—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω—é

MenuController:
- –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—á–∏—Å—Ç–∫—É —á–∞—Ç–∞
- —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–º–µ–Ω–æ–π reply-–º–µ–Ω—é
- –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ Reply ‚Üí Inline

MenuController –Ω–µ —è–≤–ª—è–µ—Ç—Å—è middleware.
–û–Ω –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–π –æ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∏ –Ω–µ –∑–Ω–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
Handlers –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Ç–∏–ø –ø–æ–≤–µ–¥–µ–Ω–∏—è (A / B / C),
MenuController –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è.

### menu_controller.py (–∏–ª–∏ utils/menu.py)
```
from aiogram.types import Message, ReplyKeyboardRemove
from aiogram.exceptions import TelegramBadRequest

class MenuController:
    def __init__(self):
        self.last_menu_message = {}

    async def clear(self, message: Message):
        chat_id = message.chat.id

        # —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        try:
            await message.delete()
        except TelegramBadRequest:
            pass

        # —É–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –º–µ–Ω—é –±–æ—Ç–∞
        if chat_id in self.last_menu_message:
            try:
                await message.bot.delete_message(
                    chat_id,
                    self.last_menu_message[chat_id]
                )
            except TelegramBadRequest:
                pass
            self.last_menu_message.pop(chat_id, None)

    async def show_reply_menu(self, message: Message, kb):
        msg = await message.answer(
            "\u200b",
            reply_markup=kb
        )
        self.last_menu_message[message.chat.id] = msg.message_id

    async def navigate(self, message: Message, kb):
        await self.clear(message)
        await self.show_reply_menu(message, kb)

    async def finish_to_inline(self, message: Message, text, inline_kb):
        await self.clear(message)
        await message.answer(text, reply_markup=inline_kb)

```

### Handler (–ø—Ä–∏–º–µ—Ä)

```
@router.message(F.text == t("admin:main:settings", lang))
async def to_settings(message: Message):
    await menu.navigate(message, admin_settings(lang))
```

```
@router.message(F.text == t("admin:settings:notifications", lang))
async def notifications(message: Message):
    await menu.finish_to_inline(
        message,
        "üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
        notifications_inline_kb()
    )

```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ FSM (Finite State Machine)

FSM **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–µ–Ω—é.

–ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ (–¢–∏–ø A, –¢–∏–ø B):
- —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ reply-handlers
- —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è MenuController
- –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

FSM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö —Ç–∏–ø–∞ C –∏ –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —á–µ—Ä–µ–∑ Inline:

- –ø–æ—à–∞–≥–æ–≤—ã–π –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö
- –º–∞—Å—Ç–µ—Ä–∞ (wizard)
- –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å FSM:
- –≤—ã–±–æ—Ä –¥–∞—Ç—ã ‚Üí –≤—Ä–µ–º–µ–Ω–∏ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- –≤–≤–æ–¥ —Å—É–º–º—ã / –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —à–∞–≥–∞–º–∏

FSM –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å MenuController:
- MenuController –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—á–∏—Å—Ç–∫—É UI
- FSM ‚Äî –∑–∞ –±–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç —à–∞–≥–∞



> `last_menu_message_id` —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º UI-—Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.
> –í production —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis.
> FSM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç `last_menu_message_id`.


## 12. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ handlers –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

–î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ reply-–∫–Ω–æ–ø–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—ã–Ω–æ—Å handlers –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏.

–ü—Ä–∏–Ω—Ü–∏–ø:

- –æ–¥–∏–Ω router –Ω–∞ —Ä–æ–ª—å
- router –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É –∫–Ω–æ–ø–∫–∏ –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–µ
- –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ handler –ø–æ `message.text`
- —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã i18n

–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

bot/
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ admin_reply.py
‚îÇ   ‚îú‚îÄ‚îÄ specialist_reply.py
‚îÇ   ‚îî‚îÄ‚îÄ client_reply.py
‚îî‚îÄ‚îÄ main.py

### –ò—Ç–æ–≥

‚úî main.py ‚Äî —Ç–æ–Ω–∫–∏–π entrypoint
‚úî –í—Å—è UI-–ª–æ–≥–∏–∫–∞ ‚Üí MenuController
‚úî –í—Å—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è ‚Üí handlers/*_reply.py
‚úî FSM ‚Äî —Ç–æ–ª—å–∫–æ –≤ flows/*

–ü—Ä–∏–Ω—è—Ç–æ. –î–µ–ª–∞–µ–º **–ø.1 ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ–º UI-–∫–æ–Ω—Ç—Ä–∞–∫—Ç**. –ù–∏–∂–µ ‚Äî **—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π, –∫–æ—Ä–æ—Ç–∫–∏–π –∏ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç**, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–ª—å—à–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –ø.2‚Äì4 –∏ —Ç–µ—Å—Ç–æ–≤ –ø.5.

---

# UI-–∫–æ–Ω—Ç—Ä–∞–∫—Ç Telegram-–±–æ—Ç–∞ (v1)

## –û–±–ª–∞—Å—Ç—å

–ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–Ω—é —Å **ReplyKeyboard** (Android-—É—Å—Ç–æ–π—á–∏–≤–æ), –±–µ–∑ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã, —Å —á–∏—Å—Ç—ã–º —á–∞—Ç–æ–º.

---

## –¢–µ—Ä–º–∏–Ω—ã

* **ReplyKeyboard** ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤–≤–æ–¥–∞ Telegram (–Ω–µ inline).
* **InlineKeyboard** ‚Äî –∫–Ω–æ–ø–∫–∏ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º (callback).
* **ZWS** ‚Äî `\u200b` (ZERO WIDTH SPACE).
* **–Ø–∫–æ—Ä—å –º–µ–Ω—é** ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ bot-—Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ Telegram –º–æ–∂–µ—Ç —Å—á–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º ReplyKeyboard.
* **last_menu_message_id** ‚Äî `message_id` —è–∫–æ—Ä—è –º–µ–Ω—é –¥–ª—è —á–∞—Ç–∞.

---

## –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã)

1. –í —á–∞—Ç–µ **—Ä–æ–≤–Ω–æ –æ–¥–∏–Ω** –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —è–∫–æ—Ä—å ReplyKeyboard.
2. –í —Ä–µ–∂–∏–º–µ Reply‚ÜíReply **—Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è**.
3. ReplyKeyboard –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** —Å **–Ω–µ–ø—É—Å—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–º** (ZWS).
4. –£–¥–∞–ª—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –ø—Ä–µ–¥—ã–¥—É—â–∏–π —è–∫–æ—Ä—å –º–µ–Ω—é (**–æ–¥–∏–Ω**, –Ω–µ ‚Äú—á–µ—Ä–µ–∑ –æ–¥–Ω–æ‚Äù).
5. –£–¥–∞–ª–µ–Ω–∏–µ —è–∫–æ—Ä—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–¥–æ** –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–æ–≤–æ–≥–æ –º–µ–Ω—é.
6. `ReplyKeyboardRemove` **–∑–∞–ø—Ä–µ—â—ë–Ω** –º–µ–∂–¥—É –º–µ–Ω—é.

–ù–∞—Ä—É—à–µ–Ω–∏–µ –ª—é–±–æ–≥–æ –ø—É–Ω–∫—Ç–∞ = —Ä–∏—Å–∫ —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—è ReplyKeyboard –Ω–∞ Android.

---

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `rooms.py` | LIST/VIEW/DELETE/CREATE + multi-select —É—Å–ª—É–≥ |
| `rooms_edit.py` | FSM —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (name, notes, order, services) |
| `api.py` | –ú–µ—Ç–æ–¥—ã rooms + service_rooms |
| `admin_reply.py` | –†–æ—É—Ç–∏–Ω–≥ + context_handlers["rooms"] |
| `menu.py` | to_rooms() –Ω–∞–≤–∏–≥–∞—Ü–∏—è |
| `admin.py` | admin_rooms() Reply keyboard |



## TODO (Telegram Bot)

- [ ] –í—ã–Ω–µ—Å—Ç–∏ reply-handlers –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ `handlers/admin_reply.py`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ handlers:
      `register_admin_handlers(dp)`
- [ ] –ü–æ–¥–∫–ª—é—á–∞—Ç—å handlers –≤ `main.py`, –±–µ–∑ –ª–æ–≥–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ `main`
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –µ–¥–∏–Ω—ã–π router –¥–ª—è reply-–∫–Ω–æ–ø–æ–∫ (1 handler –≤–º–µ—Å—Ç–æ N)
- [ ] –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:
      - specialist_reply
      - client_reply
- [ ] –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ:
      reply-–∫–Ω–æ–ø–∫–∏ –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞–º–∏
- [ ] –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `F.text == t(..., DEFAULT_LANG)` –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞—Ö
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –∏–º–ø–æ—Ä—Ç `process_update` –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –º–æ–¥—É–ª—è (–Ω–µ lazy-import)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –æ—á–∏—Å—Ç–∫—É —á–∞—Ç–∞ —á–µ—Ä–µ–∑ last_menu_message_id (—É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ–Ω—é –±–æ—Ç–∞)
- [ ] –í PROD —Ö—Ä–∞–Ω–∏—Ç—å last_menu_message_id –≤ Redis (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞)
- [ ] –í DEV –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è in-memory dict –¥–ª—è last_menu_message_id



### –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: route_by_role –∏ reply-handlers

route_by_role –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏—è.

–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:
- /start ‚Üí route_by_role() ‚Üí initial menu
- –¥–∞–ª—å–Ω–µ–π—à–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ reply-handlers

–≠—Ç–æ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π –∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.


–ù–∞–¥–æ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å

route_by_role() –∏ reply-handlers –î–£–ë–õ–ò–†–£–Æ–¢ –¥—Ä—É–≥ –¥—Ä—É–≥–∞

–°–µ–π—á–∞—Å —Å—Ö–µ–º–∞ —Ç–∞–∫–∞—è:
/start ‚Üí route_by_role() ‚Üí admin_menu()
–Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É ‚Üí reply handler ‚Üí switch_kb()
–Ω–æ –ø—Ä–∏ —ç—Ç–æ–º:
route_by_role() –±–æ–ª—å—à–µ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
reply-handlers —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –æ–±—Ö–æ–¥ router
–≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞, –Ω–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å:
‚ùó route_by_role —Ç–µ–ø–µ—Ä—å ‚Äî —Ç–æ–ª—å–∫–æ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞,
‚ùó –≤—Å—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–∞–ª—å—à–µ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ reply-handlers.
