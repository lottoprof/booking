<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ĞĞ½Ğ»Ğ°Ğ¹Ğ½-Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ â€” UPGRADE | Ğ¡Ñ‚ÑƒĞ´Ğ¸Ñ Ğ°Ğ¿Ğ¿Ğ°Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑÑÑ‚ĞµÑ‚Ğ¸ĞºĞ¸</title>
  <meta name="description" content="Ğ—Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚ĞµÑÑŒ Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½ Ğ½Ğ° LPG-Ğ¼Ğ°ÑÑĞ°Ğ¶, Ğ¿Ñ€ĞµÑÑĞ¾Ñ‚ĞµÑ€Ğ°Ğ¿Ğ¸Ñ, Ğ¾Ğ±Ñ‘Ñ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² ÑÑ‚ÑƒĞ´Ğ¸Ğ¸ UPGRADE. Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ¾Ğ±Ğ½ÑƒÑ Ğ´Ğ°Ñ‚Ñƒ Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ.">
  <meta property="og:title" content="ĞĞ½Ğ»Ğ°Ğ¹Ğ½-Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ â€” UPGRADE">
  <meta property="og:description" content="Ğ—Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚ĞµÑÑŒ Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½ Ğ½Ğ° Ğ°Ğ¿Ğ¿Ğ°Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ¼Ğ°ÑÑĞ°Ğ¶. Ğ£Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ´Ğ°Ñ‚Ñ‹ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸.">
  <meta property="og:url" content="https://upgrade-studio.ru/book.html">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Manrope:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/shared.css">
  <link rel="icon" href="logo/favicon.svg" type="image/svg+xml">

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE-SPECIFIC TOKENS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --success:     #34C77B;
      --danger:      #E74C5E;
    }
    [data-theme="light"] {
      --step-done-bg:  var(--teal-subtle);
      --step-done-text:var(--teal-dark);
    }
    [data-theme="dark"] {
      --step-done-bg:  rgba(43,181,184,0.12);
      --step-done-text:var(--teal-light);
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOOKING WIZARD LAYOUT
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .booking-page {
      flex: 1;
      padding-top: 72px;
      display: flex;
      flex-direction: column;
    }

    .booking-container {
      max-width: 720px;
      width: 100%;
      margin: 0 auto;
      padding: 2rem 1.5rem 3rem;
      flex: 1;
    }

    /* Page header */
    .booking-title {
      font-family: var(--font-display);
      font-size: 2.2rem;
      font-weight: 500;
      text-align: center;
      margin-bottom: 2rem;
      color: var(--text-primary);
    }
    .booking-title span { color: var(--teal); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STEP PROGRESS BAR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .step-inputs { display: none; }

    .progress {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2.5rem;
      position: relative;
    }

    .progress-step {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      position: relative;
    }

    .progress-dot {
      width: 36px; height: 36px;
      border-radius: 50%;
      border: 2px solid var(--border);
      background: var(--bg-primary);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.8rem; font-weight: 600;
      color: var(--text-muted);
      transition: all 0.4s ease;
      position: relative;
      z-index: 2;
    }

    .progress-label {
      font-size: 0.7rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      transition: color 0.4s ease;
      text-align: center;
    }

    /* Line between dots */
    .progress-step:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 18px;
      left: calc(50% + 22px);
      width: calc(100% - 44px);
      height: 2px;
      background: var(--border);
      z-index: 1;
      transition: background 0.4s ease;
    }

    /* Active step */
    .progress-step.active .progress-dot {
      border-color: var(--teal);
      background: var(--teal);
      color: #fff;
      box-shadow: 0 0 0 4px rgba(43,181,184,0.15);
    }
    .progress-step.active .progress-label { color: var(--teal); }

    /* Done step */
    .progress-step.done .progress-dot {
      border-color: var(--teal);
      background: var(--step-done-bg);
      color: var(--step-done-text);
    }
    .progress-step.done .progress-label { color: var(--text-secondary); }
    .progress-step.done::after { background: var(--teal); }

    @media (max-width: 480px) {
      .progress-label { font-size: 0.6rem; }
      .progress-dot { width: 30px; height: 30px; font-size: 0.7rem; }
      .progress-step:not(:last-child)::after { top: 15px; left: calc(50% + 19px); width: calc(100% - 38px); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WIZARD PAGES
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .wizard-page {
      display: none;
      animation: fadeSlideIn 0.4s ease forwards;
    }
    .wizard-page.active { display: block; }

    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .page-heading {
      font-family: var(--font-display);
      font-size: 1.6rem;
      font-weight: 500;
      margin-bottom: 0.4rem;
      color: var(--text-primary);
    }
    .page-subtitle {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SERVICE CARDS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .service-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }

    .service-card {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.1rem 1.25rem;
      border: 2px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.25s ease;
      background: var(--bg-card);
      position: relative;
    }
    .service-card:hover {
      border-color: var(--teal);
      box-shadow: var(--shadow-sm);
      transform: translateY(-1px);
    }
    .service-card.selected {
      border-color: var(--teal);
      background: var(--teal-subtle);
    }
    [data-theme="dark"] .service-card.selected { background: rgba(43,181,184,0.1); }

    .service-card .icon {
      width: 44px; height: 44px; min-width: 44px;
      border-radius: 10px;
      background: var(--teal-subtle);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.3rem;
    }
    [data-theme="dark"] .service-card .icon { background: rgba(43,181,184,0.12); }

    .service-info { flex: 1; min-width: 0; }
    .service-top {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.15rem;
    }
    .service-name {
      font-weight: 600; font-size: 0.95rem;
      color: var(--text-primary);
    }
    .service-duration {
      font-weight: 600; font-size: 0.95rem;
      color: var(--text-primary);
      white-space: nowrap;
    }
    .service-desc {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.15rem;
      line-height: 1.35;
    }
    .service-meta {
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .service-card .check-mark {
      position: absolute; top: 10px; right: 10px;
      width: 22px; height: 22px; border-radius: 50%;
      background: var(--teal); color: #fff;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.7rem; font-weight: 700;
      opacity: 0; transform: scale(0.5);
      transition: all 0.25s ease;
    }
    .service-card.selected .check-mark { opacity: 1; transform: scale(1); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CALENDAR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .calendar {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.25rem;
      box-shadow: var(--shadow-sm);
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .calendar-month {
      font-family: var(--font-display);
      font-size: 1.25rem;
      font-weight: 500;
      color: var(--text-primary);
    }
    .calendar-nav {
      display: flex; gap: 0.5rem;
    }
    .calendar-nav button {
      width: 34px; height: 34px; border-radius: 8px;
      border: 1px solid var(--border); background: var(--bg-primary);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      color: var(--text-secondary); font-size: 1rem;
      transition: all 0.2s ease;
    }
    .calendar-nav button:hover:not(:disabled) {
      border-color: var(--teal); color: var(--teal);
    }
    .calendar-nav button:disabled { opacity: 0.3; cursor: not-allowed; }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      margin-bottom: 0.4rem;
    }
    .calendar-weekdays span {
      text-align: center;
      font-size: 0.72rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      padding: 0.4rem 0;
    }

    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 3px;
    }

    .cal-day {
      aspect-ratio: 1;
      display: flex; align-items: center; justify-content: center;
      border-radius: 10px;
      font-size: 0.88rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-primary);
      position: relative;
    }
    .cal-day:hover:not(.disabled):not(.empty) {
      background: var(--teal-subtle);
      color: var(--teal-dark);
    }
    [data-theme="dark"] .cal-day:hover:not(.disabled):not(.empty) {
      background: rgba(43,181,184,0.12);
      color: var(--teal-light);
    }

    .cal-day.today::after {
      content: '';
      position: absolute;
      bottom: 4px;
      width: 4px; height: 4px;
      border-radius: 50%;
      background: var(--teal);
    }

    .cal-day.selected {
      background: var(--teal);
      color: #fff;
      font-weight: 600;
    }
    .cal-day.selected::after { background: #fff; }

    .cal-day.available {
      background: var(--bg-card);
      border: 1.5px solid var(--border);
    }
    .cal-day.available:hover {
      border-color: var(--teal);
      background: var(--teal-subtle);
    }
    .cal-day.unavailable {
      color: var(--text-muted);
      opacity: 0.35;
      cursor: not-allowed;
    }
    .cal-day.disabled {
      color: var(--text-muted);
      opacity: 0.35;
      cursor: not-allowed;
    }
    .cal-day.empty { cursor: default; }

    /* Calendar swipe animation */
    .calendar-swipe {
      transition: transform 0.25s ease, opacity 0.25s ease;
    }
    .calendar-swipe.swipe-left {
      transform: translateX(-30px);
      opacity: 0;
    }
    .calendar-swipe.swipe-right {
      transform: translateX(30px);
      opacity: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TIME SLOTS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .time-section { margin-top: 1.75rem; }

    .time-period {
      margin-bottom: 1.25rem;
    }
    .time-period-label {
      font-size: 0.78rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      margin-bottom: 0.6rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .time-period-label::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border-light);
    }

    .time-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(88px, 1fr));
      gap: 0.5rem;
    }

    .time-slot {
      padding: 0.7rem 0.25rem;
      text-align: center;
      border: 1.5px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-primary);
      transition: all 0.2s ease;
      background: var(--bg-card);
    }
    .time-slot:hover:not(.disabled) {
      border-color: var(--teal);
      color: var(--teal);
      background: var(--teal-subtle);
    }
    [data-theme="dark"] .time-slot:hover:not(.disabled) {
      background: rgba(43,181,184,0.1);
    }
    .time-slot.selected {
      border-color: var(--teal);
      background: var(--teal);
      color: #fff;
    }
    .time-slot.disabled {
      opacity: 0.3;
      cursor: not-allowed;
      background: var(--bg-secondary);
    }

    .time-empty {
      text-align: center;
      padding: 2.5rem 1rem;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SPECIALIST CARDS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .specialist-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 0.75rem;
    }

    .specialist-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      padding: 1.5rem 1rem;
      border: 2px solid var(--border);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.25s ease;
      background: var(--bg-card);
      text-align: center;
    }
    .specialist-card:hover {
      border-color: var(--teal);
      box-shadow: var(--shadow-sm);
      transform: translateY(-2px);
    }
    .specialist-card.selected {
      border-color: var(--teal);
      background: var(--teal-subtle);
    }
    [data-theme="dark"] .specialist-card.selected { background: rgba(43,181,184,0.1); }

    .specialist-avatar {
      width: 64px; height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--teal-subtle), var(--teal-light));
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem; color: var(--teal-dark);
      font-family: var(--font-display); font-weight: 600;
    }
    .specialist-name {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text-primary);
    }
    .specialist-role {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-top: -0.35rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONTACT FORM & SUMMARY
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .summary-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      padding: 0.55rem 0;
    }
    .summary-row:not(:last-child) {
      border-bottom: 1px solid var(--border-light);
    }
    .summary-label {
      font-size: 0.82rem;
      color: var(--text-secondary);
    }
    .summary-value {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--text-primary);
      text-align: right;
    }
    .summary-row.total .summary-value {
      color: var(--teal);
      font-size: 1.1rem;
    }

    .form-field {
      margin-bottom: 1rem;
    }
    .form-label {
      display: block;
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.4rem;
      letter-spacing: 0.02em;
    }
    .form-input {
      width: 100%;
      padding: 0.85rem 1rem;
      border: 1.5px solid var(--border);
      border-radius: 10px;
      background: var(--bg-card);
      color: var(--text-primary);
      font-family: var(--font-body);
      font-size: 0.95rem;
      transition: all 0.2s ease;
      outline: none;
    }
    .form-input::placeholder { color: var(--text-muted); }
    .form-input:focus {
      border-color: var(--teal);
      box-shadow: 0 0 0 3px rgba(43,181,184,0.1);
    }
    .form-input:user-valid:not(:placeholder-shown) { border-color: var(--success); }
    .form-input:user-invalid:not(:placeholder-shown) { border-color: var(--danger); }
    .form-hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.3rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NAVIGATION BUTTONS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .wizard-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2rem;
      gap: 1rem;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      font-family: var(--font-body);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
      text-decoration: none;
      border: none;
      outline: none;
    }

    .btn-back {
      background: transparent;
      border: 1.5px solid var(--border);
      color: var(--text-secondary);
    }
    .btn-back:hover { border-color: var(--teal); color: var(--teal); }

    .btn-next {
      background: var(--teal);
      color: #fff;
      margin-left: auto;
    }
    .btn-next:hover { background: var(--teal-dark); transform: translateY(-1px); }
    .btn-next:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

    .btn-confirm {
      background: var(--success);
      color: #fff;
      width: 100%;
      justify-content: center;
      padding: 1rem;
      font-size: 1rem;
      border-radius: 12px;
    }
    .btn-confirm:hover { filter: brightness(1.08); transform: translateY(-1px); }
    .btn-confirm:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LOADING & SKELETON
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .skeleton {
      background: linear-gradient(90deg, var(--border-light) 25%, var(--border) 50%, var(--border-light) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 8px;
    }
    @keyframes shimmer {
      0%   { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .skeleton-card {
      height: 72px;
      margin-bottom: 0.75rem;
    }

    .loading-overlay {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem 1rem;
      gap: 1rem;
    }

    .spinner {
      width: 32px; height: 32px;
      border: 3px solid var(--border);
      border-top-color: var(--teal);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SUCCESS STATE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .success-page {
      text-align: center;
      padding: 3rem 1rem;
    }
    .success-icon {
      width: 80px; height: 80px;
      border-radius: 50%;
      background: var(--teal-subtle);
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 1.5rem;
      font-size: 2.5rem;
      animation: popIn 0.5s ease;
    }
    [data-theme="dark"] .success-icon { background: rgba(43,181,184,0.15); }
    @keyframes popIn {
      0%   { transform: scale(0); opacity: 0; }
      60%  { transform: scale(1.15); }
      100% { transform: scale(1); opacity: 1; }
    }
    .success-title {
      font-family: var(--font-display);
      font-size: 2rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    .success-subtitle {
      color: var(--text-secondary);
      font-size: 0.95rem;
      margin-bottom: 2rem;
    }
    .success-details {
      text-align: left;
      max-width: 360px;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      .booking-title { font-size: 1.7rem; }
      .page-heading { font-size: 1.35rem; }
      .booking-container { padding: 1.25rem 1rem 2rem; }
    }
  </style>
</head>
<body>

  <!-- â”€â”€â”€ NAVIGATION â”€â”€â”€ -->
  <nav class="nav" id="navbar">
    <a href="/" class="nav-logo"><img src="logo/logo2.svg" class="nav-logo-icon" alt="UPGRADE" /><img src="logo/logo1.svg" class="nav-logo-text" alt="UPGRADE â€” ÑÑ‚ÑƒĞ´Ğ¸Ñ ÑÑÑ‚ĞµÑ‚Ğ¸ĞºĞ¸ Ñ‚ĞµĞ»Ğ°" /></a>
    <ul class="nav-links" id="navLinks">
      <li><a href="/">Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ</a></li>
      <li><a href="/#services">Ğ£ÑĞ»ÑƒĞ³Ğ¸</a></li>
      <li><a href="/pricing" aria-current="page">ĞŸÑ€Ğ°Ğ¹Ñ</a></li>
      <li><a href="/#specialists">Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ñ‹</a></li>
      <li><a href="/blog">Ğ‘Ğ»Ğ¾Ğ³</a></li>
    </ul>
    <div class="nav-right">
      <button class="theme-toggle-slider" id="themeToggle" aria-label="ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ¼Ñƒ">
        <span class="theme-toggle-icon sun">â˜€ï¸</span>
        <span class="theme-toggle-icon moon">ğŸŒ™</span>
      </button>
      <button class="nav-burger" id="navBurger" aria-label="ĞœĞµĞ½Ñ">
        <span></span><span></span><span></span>
      </button>
    </div>
  </nav>

  <!-- â”€â”€â”€ MOBILE MENU â”€â”€â”€ -->
  <div class="mobile-menu" id="mobileMenu">
    <button class="mobile-close" id="mobileClose">âœ•</button>
    <a href="/" onclick="closeMobile()">Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ</a>
    <a href="/#services" onclick="closeMobile()">Ğ£ÑĞ»ÑƒĞ³Ğ¸</a>
    <a href="/pricing" onclick="closeMobile()">ĞŸÑ€Ğ°Ğ¹Ñ</a>
    <a href="/#specialists" onclick="closeMobile()">Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ñ‹</a>
    <a href="/blog" onclick="closeMobile()">Ğ‘Ğ»Ğ¾Ğ³</a>
  </div>

  <!-- â”€â”€â”€ BOOKING WIZARD â”€â”€â”€ -->
  <main class="booking-page">
    <div class="booking-container">
      <h1 class="booking-title">ĞĞ½Ğ»Ğ°Ğ¹Ğ½-<span>Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ</span></h1>

      <!-- Progress bar -->
      <div class="progress" id="progressBar">
        <!-- Rendered by JS based on active steps -->
      </div>

      <!-- Step 1: Service -->
      <div class="wizard-page active" id="page-service" data-step="service">
        <h2 class="page-heading">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑƒÑĞ»ÑƒĞ³Ñƒ</h2>
        <p class="page-subtitle">ĞšĞ°ĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ´ÑƒÑ€Ğ° Ğ²Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒĞµÑ‚?</p>
        <div class="service-grid" id="serviceGrid">
          <div class="skeleton skeleton-card"></div>
          <div class="skeleton skeleton-card"></div>
          <div class="skeleton skeleton-card"></div>
        </div>
      </div>

      <!-- Step 2: Date -->
      <div class="wizard-page" id="page-date" data-step="date">
        <h2 class="page-heading">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ</h2>
        <p class="page-subtitle" id="dateSubtitle">Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ´Ğ½Ğ¸ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸</p>
        <div class="calendar">
          <div class="calendar-header">
            <span class="calendar-month" id="calendarMonth"></span>
            <div class="calendar-nav">
              <button id="calPrev" aria-label="ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ Ğ¼ĞµÑÑÑ†">â€¹</button>
              <button id="calNext" aria-label="Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ¼ĞµÑÑÑ†">â€º</button>
            </div>
          </div>
          <div class="calendar-weekdays">
            <span>ĞŸĞ½</span><span>Ğ’Ñ‚</span><span>Ğ¡Ñ€</span><span>Ğ§Ñ‚</span><span>ĞŸÑ‚</span><span>Ğ¡Ğ±</span><span>Ğ’Ñ</span>
          </div>
          <div class="calendar-days" id="calendarDays"></div>
        </div>
        <div class="wizard-actions">
          <button class="btn btn-back" id="backFromDate">â† ĞĞ°Ğ·Ğ°Ğ´</button>
        </div>
      </div>

      <!-- Step 3: Time -->
      <div class="wizard-page" id="page-time" data-step="time">
        <h2 class="page-heading">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ²Ñ€ĞµĞ¼Ñ</h2>
        <p class="page-subtitle" id="timeSubtitle"></p>
        <div class="time-section" id="timeSection">
          <div class="loading-overlay" id="timeLoading">
            <div class="spinner"></div>
            <span class="loading-text">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ÑĞ»Ğ¾Ñ‚Ñ‹â€¦</span>
          </div>
        </div>
        <div class="wizard-actions">
          <button class="btn btn-back" id="backFromTime">â† ĞĞ°Ğ·Ğ°Ğ´</button>
        </div>
      </div>

      <!-- Step 4: Specialist (conditional) -->
      <div class="wizard-page" id="page-specialist" data-step="specialist">
        <h2 class="page-heading">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ°</h2>
        <p class="page-subtitle" id="specialistSubtitle"></p>
        <div class="specialist-grid" id="specialistGrid"></div>
        <div class="wizard-actions">
          <button class="btn btn-back" id="backFromSpecialist">â† ĞĞ°Ğ·Ğ°Ğ´</button>
        </div>
      </div>

      <!-- Step 5: Confirm -->
      <div class="wizard-page" id="page-confirm" data-step="confirm">
        <h2 class="page-heading">ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸</h2>
        <p class="page-subtitle">ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹</p>

        <div class="summary-card" id="summaryCard"></div>

        <div class="form-field">
          <label class="form-label" for="clientName">Ğ’Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ</label>
          <input class="form-input" type="text" id="clientName" placeholder="ĞĞ½Ğ½Ğ°" required autocomplete="given-name">
        </div>
        <div class="form-field">
          <label class="form-label" for="clientPhone">Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½</label>
          <input class="form-input" type="tel" id="clientPhone" placeholder="+7 (999) 123-45-67" required autocomplete="tel">
          <div class="form-hint">Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸</div>
        </div>
        <div class="wizard-actions" style="flex-direction: column; gap: 0.75rem;">
          <button class="btn btn-confirm" id="btnSubmit">Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ</button>
          <button class="btn btn-back" id="backFromConfirm" style="align-self: flex-start;">â† ĞĞ°Ğ·Ğ°Ğ´</button>
        </div>
      </div>

      <!-- Success -->
      <div class="wizard-page" id="page-success" data-step="success">
        <div class="success-page">
          <div class="success-icon">âœ“</div>
          <h2 class="success-title">Ğ’Ñ‹ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹!</h2>
          <p class="success-subtitle">ĞœÑ‹ ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ Ñ Ğ²Ğ°Ğ¼Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ</p>
          <div class="success-details summary-card" id="successDetails"></div>
          <div style="margin-top: 1.5rem;">
            <a href="/" class="btn btn-next">ĞĞ° Ğ³Ğ»Ğ°Ğ²Ğ½ÑƒÑ â†’</a>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- â•â•â• FOOTER â•â•â• -->
  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-top">
        <div class="footer-brand">
          <a href="/" class="footer-logo">
            <img src="logo/logo2.svg" alt="UPGRADE" />
            <img src="logo/logo1.svg" alt="" />
          </a>
          <p class="footer-tagline">Ğ¡Ñ‚ÑƒĞ´Ğ¸Ñ Ğ°Ğ¿Ğ¿Ğ°Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑÑÑ‚ĞµÑ‚Ğ¸ĞºĞ¸ Ğ²&nbsp;Ğ§ĞµÑ…Ğ¾Ğ²Ğµ</p>
        </div>
        <div class="footer-content">
          <nav class="footer-row footer-nav-row">
            <a href="/#about">Ğ&nbsp;ÑÑ‚ÑƒĞ´Ğ¸Ğ¸</a>
            <a href="/#services">Ğ£ÑĞ»ÑƒĞ³Ğ¸</a>
            <a href="/#faq">Ğ’Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹</a>
            <a href="/pricing">ĞŸÑ€Ğ°Ğ¹Ñ</a>
          </nav>
        </div>
      </div>
      <div class="footer-bottom">
        <span class="footer-copy">Â© 2026 UPGRADE. Ğ’ÑĞµ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ñ‹.</span>
      </div>
    </div>
  </footer>

  <script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       API LAYER â€” connects to /web/* endpoints
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    let _locationId = null;

    async function _getLocationId() {
      if (_locationId) return _locationId;
      const res = await fetch('/web/locations');
      if (res.ok) {
        const locs = await res.json();
        if (locs.length > 0) { _locationId = locs[0].id; return _locationId; }
      }
      _locationId = 1;
      return _locationId;
    }

    class BookingAPI {
      static async getServices() {
        const res = await fetch('/web/services');
        if (!res.ok) throw new Error(`API error: ${res.status}`);
        return res.json();  // PricingCard[]
      }

      static async getCalendar(locationId) {
        const res = await fetch(`/web/slots/calendar?location_id=${locationId}`);
        if (!res.ok) throw new Error(`Calendar error: ${res.status}`);
        return res.json();  // { days: [{date, has_slots}] }
      }

      static async getAvailableSlots(packageId, date) {
        const locationId = await _getLocationId();
        const params = new URLSearchParams({
          location_id: locationId,
          service_package_id: packageId,
          date: date,
        });
        const res = await fetch(`/web/slots/day?${params}`);
        if (!res.ok) return [];
        const data = await res.json();
        return (data.slots || []).map(s => ({
          time: s.time,
          available: s.available !== false,
          specialists: s.specialists || [],
        }));
      }

      static async reserveSlot(packageId, date, time, specialistId) {
        const locationId = await _getLocationId();
        const res = await fetch('/web/reserve', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            location_id: locationId,
            service_package_id: packageId,
            specialist_id: specialistId || null,
            date: date,
            time: time,
          }),
        });
        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          throw new Error(err.detail || 'Slot unavailable');
        }
        return res.json();
      }

      static async submitBooking(data) {
        const res = await fetch('/web/booking', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            reserve_uuid: data.reserve_uuid,
            phone: data.client_phone,
            name: data.client_name || null,
          }),
        });
        if (!res.ok) throw new Error('Booking failed');
        const result = await res.json();

        // Poll for confirmation (max 15 seconds)
        const uuid = result.uuid;
        for (let i = 0; i < 15; i++) {
          await new Promise(r => setTimeout(r, 1000));
          const poll = await fetch(`/web/booking/${uuid}`);
          if (!poll.ok) continue;
          const status = await poll.json();
          if (status.status === 'confirmed') {
            return { success: true, booking_id: status.booking_id || uuid };
          }
          if (status.status === 'failed') {
            throw new Error(status.error || 'Booking failed');
          }
        }
        // Timeout â€” return success with UUID (consumer will process async)
        return { success: true, booking_id: uuid };
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HELPERS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function fmtPrice(n) {
      return Math.round(n).toLocaleString('ru-RU');
    }

    function priceRange(variants) {
      // min = per_session of largest package (10â†’5â†’1), max = single session price
      const sorted = [...variants].sort((a, b) => b.qty - a.qty);
      const min = sorted[0].per_session ?? sorted[0].price;
      const single = variants.find(v => v.qty === 1);
      const max = single ? single.price : min;
      if (min === max) return `${fmtPrice(min)} â‚½`;
      return `Ğ¾Ñ‚ ${fmtPrice(min)} Ğ´Ğ¾ ${fmtPrice(max)} â‚½`;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOOKING WIZARD
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    class BookingWizard {
      constructor() {
        this.state = {
          service: null,   // { slug, name, duration_min, icon, category, packageId, price }
          date: null,
          time: null,
          specialist: null,
        };

        // Dynamic step list â€” specialist may be skipped
        this.steps = ['service', 'date', 'time', 'specialist', 'confirm'];
        this.activeSteps = [...this.steps];
        this.currentStep = 'service';

        this.services = [];       // PricingCard[]
        this.availableDays = new Map();
        this.currentMonth = new Date();
        this._calendarBound = false;
        this._swipeReady = false;

        this.init();
      }

      async init() {
        this.bindNav();
        this.bindForm();
        await this.loadServices();
        this.checkUrlParams();
        this.renderProgress();
      }

      /* â”€â”€ Navigation â”€â”€ */
      bindNav() {
        document.getElementById('backFromDate').addEventListener('click', () => this.goTo('service'));
        document.getElementById('backFromTime').addEventListener('click', () => this.goTo('date'));
        document.getElementById('backFromSpecialist').addEventListener('click', () => this.goTo('time'));
        document.getElementById('backFromConfirm').addEventListener('click', () => {
          const prev = this.activeSteps.includes('specialist') ? 'specialist' : 'time';
          this.goTo(prev);
        });
      }

      goTo(step) {
        document.querySelectorAll('.wizard-page').forEach(p => p.classList.remove('active'));
        const page = document.getElementById(`page-${step}`);
        if (page) {
          page.classList.remove('active');
          void page.offsetWidth;
          page.classList.add('active');
        }
        this.currentStep = step;
        this.renderProgress();
        document.querySelector('.booking-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      renderProgress() {
        const bar = document.getElementById('progressBar');
        const labels = {
          service: 'Ğ£ÑĞ»ÑƒĞ³Ğ°',
          date: 'Ğ”Ğ°Ñ‚Ğ°',
          time: 'Ğ’Ñ€ĞµĞ¼Ñ',
          specialist: 'Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚',
          confirm: 'Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ',
        };

        const steps = this.activeSteps;
        const currentIdx = steps.indexOf(this.currentStep);

        bar.innerHTML = steps.map((step, i) => {
          let cls = '';
          if (i < currentIdx) cls = 'done';
          else if (i === currentIdx) cls = 'active';

          return `
            <div class="progress-step ${cls}">
              <div class="progress-dot">${cls === 'done' ? 'âœ“' : i + 1}</div>
              <span class="progress-label">${labels[step]}</span>
            </div>
          `;
        }).join('');
      }

      updateActiveSteps(specialists) {
        if (!specialists || specialists.length <= 1) {
          this.activeSteps = this.steps.filter(s => s !== 'specialist');
        } else {
          this.activeSteps = [...this.steps];
        }
      }

      /* â”€â”€ Services (PricingCard[]) â”€â”€ */
      async loadServices() {
        const grid = document.getElementById('serviceGrid');
        try {
          this.services = await BookingAPI.getServices();
          grid.innerHTML = '';
          this.services.forEach(card => {
            const presetVariant = card.variants.find(v => v.qty === 1) || card.variants[0];
            if (!presetVariant) return;

            const el = document.createElement('div');
            el.className = 'service-card';
            el.dataset.slug = card.slug;
            const range = priceRange(card.variants);
            el.innerHTML = `
              <div class="icon">${card.icon}</div>
              <div class="service-info">
                <div class="service-top">
                  <div class="service-name">${card.name}</div>
                  <div class="service-duration">${card.duration_min} Ğ¼Ğ¸Ğ½</div>
                </div>
                ${card.description ? `<div class="service-desc">${card.description}</div>` : ''}
                <div class="service-meta">${range}</div>
              </div>
            `;
            el.addEventListener('click', () => this.selectService(card, presetVariant));
            grid.appendChild(el);
          });
        } catch (e) {
          grid.innerHTML = '<p style="text-align:center;color:var(--danger);padding:2rem">ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑƒÑĞ»ÑƒĞ³Ğ¸. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.</p>';
        }
      }

      selectService(card, presetVariant) {
        this.state.service = {
          slug: card.slug,
          name: card.name,
          duration_min: card.duration_min,
          icon: card.icon,
          category: card.category,
          packageId: presetVariant.package_id,
          price: presetVariant.price,
        };
        // Reset downstream
        this.state.date = null;
        this.state.time = null;
        this.state.specialist = null;

        setTimeout(() => {
          this.loadCalendar();
        }, 250);
      }

      checkUrlParams() {
        const params = new URLSearchParams(window.location.search);
        const slug = params.get('service');
        if (slug) {
          const card = this.services.find(s => s.slug === slug);
          if (card) {
            const presetVariant = card.variants.find(v => v.qty === 1) || card.variants[0];
            if (presetVariant) {
              this.selectService(card, presetVariant);
            }
          }
        }
      }

      /* â”€â”€ Calendar (availability API) â”€â”€ */
      async loadCalendar() {
        try {
          const locationId = await _getLocationId();
          const data = await BookingAPI.getCalendar(locationId);
          this.availableDays.clear();
          for (const day of data.days) this.availableDays.set(day.date, day.has_slots);

          // Jump to first available month
          const first = data.days.find(d => d.has_slots);
          if (first) {
            this.currentMonth = new Date(first.date);
          } else {
            this.currentMonth = new Date();
          }

          if (!this._calendarBound) {
            this._calendarBound = true;
            document.getElementById('calPrev').addEventListener('click', () => this.navigateMonth(-1));
            document.getElementById('calNext').addEventListener('click', () => this.navigateMonth(1));
          }

          this.renderCalendar();
          this.goTo('date');

          document.getElementById('dateSubtitle').textContent =
            `${this.state.service.name} Â· ${this.state.service.duration_min} Ğ¼Ğ¸Ğ½`;
        } catch (e) {
          console.error('Calendar load failed:', e);
        }
      }

      navigateMonth(dir) {
        if (this._navigating) return;
        const btn = document.getElementById(dir > 0 ? 'calNext' : 'calPrev');
        if (btn?.disabled) return;

        this._navigating = true;
        const grid = document.getElementById('calendarDays');
        grid.classList.add('calendar-swipe', dir > 0 ? 'swipe-left' : 'swipe-right');

        setTimeout(() => {
          this.currentMonth.setMonth(this.currentMonth.getMonth() + dir);
          this.renderCalendar();
          grid.classList.remove('calendar-swipe', 'swipe-left', 'swipe-right');
          this._navigating = false;
        }, 250);
      }

      renderCalendar() {
        const grid = document.getElementById('calendarDays');
        const today = new Date();
        today.setHours(0,0,0,0);

        const year = this.currentMonth.getFullYear();
        const month = this.currentMonth.getMonth();

        const monthNames = ['Ğ¯Ğ½Ğ²Ğ°Ñ€ÑŒ','Ğ¤ĞµĞ²Ñ€Ğ°Ğ»ÑŒ','ĞœĞ°Ñ€Ñ‚','ĞĞ¿Ñ€ĞµĞ»ÑŒ','ĞœĞ°Ğ¹','Ğ˜ÑĞ½ÑŒ',
                            'Ğ˜ÑĞ»ÑŒ','ĞĞ²Ğ³ÑƒÑÑ‚','Ğ¡ĞµĞ½Ñ‚ÑĞ±Ñ€ÑŒ','ĞĞºÑ‚ÑĞ±Ñ€ÑŒ','ĞĞ¾ÑĞ±Ñ€ÑŒ','Ğ”ĞµĞºĞ°Ğ±Ñ€ÑŒ'];
        document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;

        // Nav limits
        const cur = year * 12 + month;
        const min = today.getFullYear() * 12 + today.getMonth();
        const max = min + 3;
        document.getElementById('calPrev').disabled = cur <= min;
        document.getElementById('calNext').disabled = cur >= max;

        const firstDay = new Date(year, month, 1);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        let startDay = (firstDay.getDay() + 6) % 7; // Mon=0

        let html = '';
        for (let i = 0; i < startDay; i++) html += '<div class="cal-day empty"></div>';

        for (let d = 1; d <= daysInMonth; d++) {
          const date = new Date(year, month, d);
          const iso = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
          const isPast = date < today;
          const avail = !isPast && this.availableDays.get(iso);
          const isToday = date.getTime() === today.getTime();
          const isSelected = iso === this.state.date;

          const cls = ['cal-day'];
          if (isToday) cls.push('today');
          if (isSelected) cls.push('selected');
          if (avail) cls.push('available');
          else cls.push('unavailable');

          html += `<div class="${cls.join(' ')}" data-date="${iso}">${d}</div>`;
        }

        grid.innerHTML = html;
        grid.onclick = e => {
          const el = e.target.closest('.cal-day');
          if (el?.classList.contains('available')) this.selectDate(el.dataset.date);
        };

        // Init swipe once
        if (!this._swipeReady) {
          this._swipeReady = true;
          this.initCalendarSwipe();
        }
      }

      initCalendarSwipe() {
        const el = document.getElementById('page-date');
        let startX = 0, startY = 0;

        el.addEventListener('touchstart', e => {
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
        }, { passive: true });

        el.addEventListener('touchend', e => {
          const dx = e.changedTouches[0].clientX - startX;
          const dy = e.changedTouches[0].clientY - startY;
          if (Math.abs(dx) > 60 && Math.abs(dx) > Math.abs(dy) * 2) {
            this.navigateMonth(dx < 0 ? 1 : -1);
          }
        }, { passive: true });
      }

      selectDate(iso) {
        this.state.date = iso;
        this.state.time = null;
        this.renderCalendar();

        setTimeout(() => {
          this.goTo('time');
          this.loadTimeSlots();
        }, 200);
      }

      /* â”€â”€ Time Slots â”€â”€ */
      async loadTimeSlots() {
        const section = document.getElementById('timeSection');
        const loading = document.getElementById('timeLoading');
        section.innerHTML = '';
        section.appendChild(loading);
        loading.style.display = 'flex';

        const dateObj = new Date(this.state.date + 'T00:00:00');
        const formatted = dateObj.toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' });
        document.getElementById('timeSubtitle').textContent =
          `${this.state.service.name} Â· ${formatted}`;

        try {
          const slots = await BookingAPI.getAvailableSlots(this.state.service.packageId, this.state.date);
          loading.style.display = 'none';

          // Collect all specialists from slots for later use
          this._slotSpecialists = new Map();
          slots.forEach(s => {
            if (s.specialists && s.specialists.length > 0) {
              this._slotSpecialists.set(s.time, s.specialists);
            }
          });

          // Group by period
          const periods = {
            'Ğ£Ñ‚Ñ€Ğ¾': slots.filter(s => { const h = parseInt(s.time); return h >= 9 && h < 12; }),
            'Ğ”ĞµĞ½ÑŒ': slots.filter(s => { const h = parseInt(s.time); return h >= 12 && h < 18; }),
            'Ğ’ĞµÑ‡ĞµÑ€': slots.filter(s => { const h = parseInt(s.time); return h >= 18; }),
          };

          let hasAny = false;
          Object.entries(periods).forEach(([label, pSlots]) => {
            const available = pSlots.filter(s => s.available);
            if (available.length === 0 && pSlots.length === 0) return;

            hasAny = hasAny || available.length > 0;

            const period = document.createElement('div');
            period.className = 'time-period';
            period.innerHTML = `<div class="time-period-label">${label}</div>`;

            const grid = document.createElement('div');
            grid.className = 'time-grid';

            pSlots.forEach(slot => {
              const el = document.createElement('div');
              el.className = `time-slot ${slot.available ? '' : 'disabled'}`;
              el.textContent = slot.time;
              if (slot.available) {
                el.addEventListener('click', () => this.selectTime(slot, el));
              }
              grid.appendChild(el);
            });

            period.appendChild(grid);
            section.appendChild(period);
          });

          if (!hasAny) {
            section.innerHTML = '<div class="time-empty">ĞĞ° ÑÑ‚Ğ¾Ñ‚ Ğ´ĞµĞ½ÑŒ Ğ½ĞµÑ‚ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ… ÑĞ»Ğ¾Ñ‚Ğ¾Ğ². ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ³ÑƒÑ Ğ´Ğ°Ñ‚Ñƒ.</div>';
          }

        } catch (e) {
          loading.style.display = 'none';
          section.innerHTML = '<div class="time-empty" style="color:var(--danger)">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.</div>';
        }
      }

      selectTime(slot, el) {
        document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
        el.classList.add('selected');
        this.state.time = slot.time;

        // Get specialists from slot data
        const specialists = slot.specialists || [];
        this.updateActiveSteps(specialists);

        setTimeout(() => {
          if (specialists.length > 1) {
            this.renderSpecialists(specialists);
            this.goTo('specialist');
          } else {
            this.state.specialist = specialists[0] || null;
            this.renderSummary();
            this.goTo('confirm');
          }
        }, 200);
      }

      /* â”€â”€ Specialists â”€â”€ */
      renderSpecialists(specialists) {
        const grid = document.getElementById('specialistGrid');
        grid.innerHTML = '';

        const dateObj = new Date(this.state.date + 'T00:00:00');
        const formatted = dateObj.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
        document.getElementById('specialistSubtitle').textContent =
          `${this.state.service.name} Â· ${formatted} Ğ² ${this.state.time}`;

        // "Any specialist" option
        const anyCard = this.createSpecialistCard({ id: null, name: 'Ğ›ÑĞ±Ğ¾Ğ¹ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚', description: 'ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğ¹' }, 'ğŸ²');
        grid.appendChild(anyCard);

        specialists.forEach(sp => {
          const initials = sp.name ? sp.name.split(' ').map(w => w[0]).join('') : '?';
          grid.appendChild(this.createSpecialistCard(sp, initials));
        });
      }

      createSpecialistCard(sp, avatarContent) {
        const card = document.createElement('div');
        card.className = 'specialist-card';
        card.innerHTML = `
          <div class="specialist-avatar">${avatarContent}</div>
          <div class="specialist-name">${sp.name || ''}</div>
          <div class="specialist-role">${sp.description || ''}</div>
        `;
        card.addEventListener('click', () => {
          document.querySelectorAll('.specialist-card').forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          this.state.specialist = sp.id ? sp : null;

          setTimeout(() => {
            this.renderSummary();
            this.goTo('confirm');
          }, 250);
        });
        return card;
      }

      /* â”€â”€ Summary & Submit â”€â”€ */
      async renderSummary() {
        const dateObj = new Date(this.state.date + 'T00:00:00');
        const dateStr = dateObj.toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' });

        const endTime = this.calcEndTime(this.state.time, this.state.service.duration_min);

        let rows = `
          <div class="summary-row">
            <span class="summary-label">Ğ£ÑĞ»ÑƒĞ³Ğ°</span>
            <span class="summary-value">${this.state.service.name}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Ğ”Ğ°Ñ‚Ğ°</span>
            <span class="summary-value">${dateStr}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Ğ’Ñ€ĞµĞ¼Ñ</span>
            <span class="summary-value">${this.state.time} â€“ ${endTime}</span>
          </div>
        `;

        if (this.state.specialist) {
          rows += `
            <div class="summary-row">
              <span class="summary-label">Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚</span>
              <span class="summary-value">${this.state.specialist.name || ''}</span>
            </div>
          `;
        }

        rows += `
          <div class="summary-row total">
            <span class="summary-label">Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ</span>
            <span class="summary-value">${fmtPrice(this.state.service.price)} â‚½</span>
          </div>
        `;

        document.getElementById('summaryCard').innerHTML = rows;

        // Reserve the slot (5 min hold)
        try {
          const reservation = await BookingAPI.reserveSlot(
            this.state.service.packageId,
            this.state.date,
            this.state.time,
            this.state.specialist?.id
          );
          this.state.reserveUuid = reservation.uuid;
        } catch (e) {
          document.getElementById('summaryCard').innerHTML += `
            <div class="summary-row" style="color:var(--danger); margin-top:0.5rem;">
              Ğ’Ñ€ĞµĞ¼Ñ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ½ÑÑ‚Ğ¾. Ğ’ĞµÑ€Ğ½Ğ¸Ñ‚ĞµÑÑŒ Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ÑĞ»Ğ¾Ñ‚.
            </div>`;
          document.getElementById('btnSubmit').disabled = true;
        }
      }

      calcEndTime(start, durationMin) {
        const [h, m] = start.split(':').map(Number);
        const total = h * 60 + m + durationMin;
        return `${String(Math.floor(total / 60)).padStart(2, '0')}:${String(total % 60).padStart(2, '0')}`;
      }

      bindForm() {
        const phone = document.getElementById('clientPhone');
        phone.addEventListener('input', (e) => {
          let val = e.target.value.replace(/\D/g, '');
          if (val.startsWith('8')) val = '7' + val.slice(1);
          if (!val.startsWith('7') && val.length > 0) val = '7' + val;

          let formatted = '';
          if (val.length > 0) formatted = '+' + val[0];
          if (val.length > 1) formatted += ' (' + val.substring(1, 4);
          if (val.length > 4) formatted += ') ' + val.substring(4, 7);
          if (val.length > 7) formatted += '-' + val.substring(7, 9);
          if (val.length > 9) formatted += '-' + val.substring(9, 11);

          e.target.value = formatted;
        });

        document.getElementById('btnSubmit').addEventListener('click', () => this.submit());
      }

      async submit() {
        const name = document.getElementById('clientName').value.trim();
        const phone = document.getElementById('clientPhone').value.trim();

        if (!name) { document.getElementById('clientName').focus(); return; }
        if (phone.replace(/\D/g, '').length < 11) { document.getElementById('clientPhone').focus(); return; }

        if (!this.state.reserveUuid) {
          alert('Ğ¡Ğ»Ğ¾Ñ‚ Ğ½Ğµ Ğ·Ğ°Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. Ğ’ĞµÑ€Ğ½Ğ¸Ñ‚ĞµÑÑŒ Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾.');
          return;
        }

        const btn = document.getElementById('btnSubmit');
        btn.disabled = true;
        btn.textContent = 'Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼â€¦';

        try {
          const result = await BookingAPI.submitBooking({
            reserve_uuid: this.state.reserveUuid,
            client_name: name,
            client_phone: phone.replace(/\D/g, ''),
          });

          if (result.success) {
            this.renderSuccess(result.booking_id);
            this.goTo('success');
          }
        } catch (e) {
          btn.disabled = false;
          btn.textContent = 'Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ';
          alert('ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ĞµÑ‰Ñ‘ Ñ€Ğ°Ğ·.');
        }
      }

      renderSuccess(bookingId) {
        const dateObj = new Date(this.state.date + 'T00:00:00');
        const dateStr = dateObj.toLocaleDateString('ru-RU', { weekday: 'short', day: 'numeric', month: 'long' });

        document.getElementById('successDetails').innerHTML = `
          <div class="summary-row">
            <span class="summary-label">ĞĞ¾Ğ¼ĞµÑ€ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸</span>
            <span class="summary-value">${bookingId}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Ğ£ÑĞ»ÑƒĞ³Ğ°</span>
            <span class="summary-value">${this.state.service.name}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">ĞšĞ¾Ğ³Ğ´Ğ°</span>
            <span class="summary-value">${dateStr}, ${this.state.time}</span>
          </div>
        `;

        // Hide progress bar for success
        document.getElementById('progressBar').style.display = 'none';
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       THEME & NAV (shared logic)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const html = document.documentElement;
    const themeBtn = document.getElementById('themeToggle');
    const saved = localStorage.getItem('theme');
    if (saved) html.setAttribute('data-theme', saved);

    themeBtn.addEventListener('click', () => {
      const next = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    });

    const nav = document.getElementById('navbar');
    window.addEventListener('scroll', () => {
      nav.classList.toggle('scrolled', window.scrollY > 40);
    }, { passive: true });

    const burger = document.getElementById('navBurger');
    const mobileMenu = document.getElementById('mobileMenu');
    const mobileClose = document.getElementById('mobileClose');
    burger.addEventListener('click', () => mobileMenu.classList.add('active'));
    mobileClose.addEventListener('click', closeMobile);
    function closeMobile() { mobileMenu.classList.remove('active'); }

    /* â”€â”€ Start â”€â”€ */
    document.addEventListener('DOMContentLoaded', () => new BookingWizard());
  </script>
</body>
</html>
